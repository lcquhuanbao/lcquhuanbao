(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73a0d001"],{"02e2":function(e,t,n){e.exports=n.p+"img/01Hai.e856ecd4.gif"},"03d0":function(e,t,n){e.exports=n.p+"img/02对不起.5f6aec9a.gif"},"1cc9":function(e,t,n){e.exports=n.p+"img/08哇哦.6d25c655.gif"},2486:function(e,t,n){"use strict";var o=n("7037"),r=n.n(o),i={function:function(e){var t=function(e,t){return e+t&4294967295},n=function(e,n,o,r,i,s){return n=t(t(n,e),t(r,s)),t(n<<i|n>>>32-i,o)},o=function(e,t,o,r,i,s,a){return n(t&o|~t&r,e,t,i,s,a)},r=function(e,t,o,r,i,s,a){return n(t&r|o&~r,e,t,i,s,a)},i=function(e,t,o,r,i,s,a){return n(t^o^r,e,t,i,s,a)},s=function(e,t,o,r,i,s,a){return n(o^(t|~r),e,t,i,s,a)},a=function(e,n){var a=e[0],u=e[1],c=e[2],l=e[3];a=o(a,u,c,l,n[0],7,-680876936),l=o(l,a,u,c,n[1],12,-389564586),c=o(c,l,a,u,n[2],17,606105819),u=o(u,c,l,a,n[3],22,-1044525330),a=o(a,u,c,l,n[4],7,-176418897),l=o(l,a,u,c,n[5],12,1200080426),c=o(c,l,a,u,n[6],17,-1473231341),u=o(u,c,l,a,n[7],22,-45705983),a=o(a,u,c,l,n[8],7,1770035416),l=o(l,a,u,c,n[9],12,-1958414417),c=o(c,l,a,u,n[10],17,-42063),u=o(u,c,l,a,n[11],22,-1990404162),a=o(a,u,c,l,n[12],7,1804603682),l=o(l,a,u,c,n[13],12,-40341101),c=o(c,l,a,u,n[14],17,-1502002290),u=o(u,c,l,a,n[15],22,1236535329),a=r(a,u,c,l,n[1],5,-165796510),l=r(l,a,u,c,n[6],9,-1069501632),c=r(c,l,a,u,n[11],14,643717713),u=r(u,c,l,a,n[0],20,-373897302),a=r(a,u,c,l,n[5],5,-701558691),l=r(l,a,u,c,n[10],9,38016083),c=r(c,l,a,u,n[15],14,-660478335),u=r(u,c,l,a,n[4],20,-405537848),a=r(a,u,c,l,n[9],5,568446438),l=r(l,a,u,c,n[14],9,-1019803690),c=r(c,l,a,u,n[3],14,-187363961),u=r(u,c,l,a,n[8],20,1163531501),a=r(a,u,c,l,n[13],5,-1444681467),l=r(l,a,u,c,n[2],9,-51403784),c=r(c,l,a,u,n[7],14,1735328473),u=r(u,c,l,a,n[12],20,-1926607734),a=i(a,u,c,l,n[5],4,-378558),l=i(l,a,u,c,n[8],11,-2022574463),c=i(c,l,a,u,n[11],16,1839030562),u=i(u,c,l,a,n[14],23,-35309556),a=i(a,u,c,l,n[1],4,-1530992060),l=i(l,a,u,c,n[4],11,1272893353),c=i(c,l,a,u,n[7],16,-155497632),u=i(u,c,l,a,n[10],23,-1094730640),a=i(a,u,c,l,n[13],4,681279174),l=i(l,a,u,c,n[0],11,-358537222),c=i(c,l,a,u,n[3],16,-722521979),u=i(u,c,l,a,n[6],23,76029189),a=i(a,u,c,l,n[9],4,-640364487),l=i(l,a,u,c,n[12],11,-421815835),c=i(c,l,a,u,n[15],16,530742520),u=i(u,c,l,a,n[2],23,-995338651),a=s(a,u,c,l,n[0],6,-198630844),l=s(l,a,u,c,n[7],10,1126891415),c=s(c,l,a,u,n[14],15,-1416354905),u=s(u,c,l,a,n[5],21,-57434055),a=s(a,u,c,l,n[12],6,1700485571),l=s(l,a,u,c,n[3],10,-1894986606),c=s(c,l,a,u,n[10],15,-1051523),u=s(u,c,l,a,n[1],21,-2054922799),a=s(a,u,c,l,n[8],6,1873313359),l=s(l,a,u,c,n[15],10,-30611744),c=s(c,l,a,u,n[6],15,-1560198380),u=s(u,c,l,a,n[13],21,1309151649),a=s(a,u,c,l,n[4],6,-145523070),l=s(l,a,u,c,n[11],10,-1120210379),c=s(c,l,a,u,n[2],15,718787259),u=s(u,c,l,a,n[9],21,-343485551),e[0]=t(a,e[0]),e[1]=t(u,e[1]),e[2]=t(c,e[2]),e[3]=t(l,e[3])},u=function(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n},c=function(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},l=function(e){var t,n,o,r,i,s,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)a(l,u(e.substring(t-64,t)));for(e=e.substring(t-64),n=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(a(l,o),t=0;t<16;t+=1)o[t]=0;return r=8*c,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),s=parseInt(r[1],16)||0,o[14]=i,o[15]=s,a(l,o),l},f=function(e){var t,n,o,r,i,s,u=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)a(l,c(e.subarray(t-64,t)));for(e=t-64<u?e.subarray(t-64):new Uint8Array(0),n=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(a(l,o),t=0;t<16;t+=1)o[t]=0;return r=8*u,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),s=parseInt(r[1],16)||0,o[14]=i,o[15]=s,a(l,o),l},p=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],g=function(e){var t,n="";for(t=0;t<4;t+=1)n+=p[e>>8*t+4&15]+p[e>>8*t&15];return n},d=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=g(e[t]);return e.join("")},m=function(e){return d(l(e))},I=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==m("hello")&&(t=function(e,t){var n=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(n>>16);return o<<16|65535&n}),I.prototype.append=function(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),this.appendBinary(e),this},I.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)a(this._state,u(this._buff.substring(t-64,t)));return this._buff=this._buff.substr(t-64),this},I.prototype.end=function(e){var t,n,o=this._buff,r=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)i[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return this._finish(i,r),n=e?this._state:d(this._state),this.reset(),n},I.prototype._finish=function(e,t){var n,o,r,i=t;if(e[i>>2]|=128<<(i%4<<3),i>55)for(a(this._state,e),i=0;i<16;i+=1)e[i]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),r=parseInt(n[1],16)||0,e[14]=o,e[15]=r,a(this._state,e)},I.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},I.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},I.hash=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var n=l(e);return t?n:d(n)},I.hashBinary=function(e,t){var n=l(e);return t?n:d(n)},I.ArrayBuffer=function(){this.reset()},I.ArrayBuffer.prototype.append=function(e){var t,n=this._concatArrayBuffer(this._buff,e),o=n.length;for(this._length+=e.byteLength,t=64;t<=o;t+=64)a(this._state,c(n.subarray(t-64,t)));return this._buff=t-64<o?n.subarray(t-64):new Uint8Array(0),this},I.ArrayBuffer.prototype.end=function(e){var t,n,o=this._buff,r=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)i[t>>2]|=o[t]<<(t%4<<3);return this._finish(i,r),n=e?this._state:d(this._state),this.reset(),n},I.ArrayBuffer.prototype._finish=I.prototype._finish,I.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},I.ArrayBuffer.prototype.destroy=I.prototype.destroy,I.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var n=e.length,o=new Uint8Array(n+t.byteLength);return o.set(e),o.set(new Uint8Array(t),n),o},I.ArrayBuffer.hash=function(e,t){var n=f(new Uint8Array(e));return t?n:d(n)},I}},s=n("bc3a"),a=n.n(s);"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e.apply(this,[this[t],t,this])});var u={},c={login:function(e,t,n){},syncMsgs:function(e,t){},getC2CHistoryMsgs:function(e,t,n){},syncGroupMsgs:function(e,t,n){},sendMsg:function(e,t,n){},logout:function(e,t){},setAutoRead:function(e,t,n){},getProfilePortrait:function(e,t,n){},setProfilePortrait:function(e,t,n){},applyAddFriend:function(e,t,n){},getPendency:function(e,t,n){},deletePendency:function(e,t,n){},responseFriend:function(e,t,n){},getAllFriend:function(e,t,n){},deleteFriend:function(e,t,n){},addBlackList:function(e,t,n){},getBlackList:function(e,t,n){},deleteBlackList:function(e,t,n){},uploadPic:function(e,t,n){},createGroup:function(e,t,n){},applyJoinGroup:function(e,t,n){},handleApplyJoinGroup:function(e,t,n){},deleteApplyJoinGroupPendency:function(e,t,n){},quitGroup:function(e,t,n){},getGroupPublicInfo:function(e,t,n){},getGroupInfo:function(e,t,n){},modifyGroupBaseInfo:function(e,t,n){},destroyGroup:function(e,t,n){},getJoinedGroupListHigh:function(e,t,n){},getGroupMemberInfo:function(e,t,n){},addGroupMember:function(e,t,n){},modifyGroupMember:function(e,t,n){},forbidSendMsg:function(e,t,n){},deleteGroupMember:function(e,t,n){},getPendencyGroup:function(e,t,n){},getPendencyReport:function(e,t,n){},getPendencyGroupRead:function(e,t,n){},sendCustomGroupNotify:function(e,t,n){},Msg:function(e,t,n,o,r,i,s,a,u){},MsgStore:{sessMap:function(){return{}},sessCount:function(){return 0},sessByTypeId:function(e,t){return{}},delSessByTypeId:function(e,t){return!0},resetCookieAndSyncFlag:function(){},downloadMap:{}}};(function(e){var t={VERSION:"1.7.2",APPID:"1400194712",PLAATFORM:"10"},o=!0,s={FORMAL:{COMMON:"https://webim.tim.qq.com",PIC:"https://pic.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com",PIC:"https://pic.tim.qq.com"}},c={},l={OPEN_IM:"openim",GROUP:"group_open_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",DEL_CHAT:"recentcontact",WEB_IM:"webim"},f={openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v1",group_open_long_polling_http_noauth_svc:"v1",imopenstat:"v4",webim:"v3"},p={login:1,pic_up:3,apply_join_group:9,create_group:10,longpolling:18,send_group_msg:19,sendmsg:20},g={C2C:"C2C",GROUP:"GROUP"},d={C2C:1,GROUP:2},m={C2C:12e3,GROUP:8898},I={OK:"OK",FAIL:"FAIL"},_=99999,M={TEXT:"TIMTextElem",FACE:"TIMFaceElem",IMAGE:"TIMImageElem",CUSTOM:"TIMCustomElem",SOUND:"TIMSoundElem",FILE:"TIMFileElem",LOCATION:"TIMLocationElem",GROUP_TIP:"TIMGroupTipElem"},E={ORIGIN:1,LARGE:2,SMALL:3},T={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},h={RAW_DATA:0,BASE64_DATA:1},y={BUSSINESS_ID:"10001",AUTH_KEY:"617574686b6579",SERVER_IP:"182.140.186.147",SOUND_SERVER_DOMAIN:"grouptalk.c2c.qq.com"},S={SOUND:2106,FILE:2107},C={IMAGE:1,FILE:2,SHORT_VIDEO:3,SOUND:4},A={APP_VERSION:"2.1",SERVER_VERSION:1},G={C2C:1,GROUP_COMMON:3,GROUP_TIP:4,GROUP_SYSTEM:5,GROUP_TIP2:6,FRIEND_NOTICE:7,PROFILE_NOTICE:8,C2C_COMMON:9,C2C_EVENT:10},O={COMMON:0},P={READED:92,KICKEDOUT:96},N={COMMON:0,LOVEMSG:1,TIP:2,REDPACKET:3},v={REDPACKET:1,COMMON:2,LOVEMSG:3},F={JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7},R={FACE_URL:1,NAME:2,OWNER:3,NOTIFICATION:4,INTRODUCTION:5},b={JOIN_GROUP_REQUEST:1,JOIN_GROUP_ACCEPT:2,JOIN_GROUP_REFUSE:3,KICK:4,DESTORY:5,CREATE:6,INVITED_JOIN_GROUP_REQUEST:7,QUIT:8,SET_ADMIN:9,CANCEL_ADMIN:10,REVOKE:11,READED:15,CUSTOM:255,INVITED_JOIN_GROUP_REQUEST_AGREE:12},U={FRIEND_ADD:1,FRIEND_DELETE:2,PENDENCY_ADD:3,PENDENCY_DELETE:4,BLACK_LIST_ADD:5,BLACK_LIST_DELETE:6,PENDENCY_REPORT:7,FRIEND_UPDATE:8},L={PROFILE_MODIFY:1},k={OK:0,SIGNATURE_EXPIRATION:11},D={INIT:-1,ON:0,RECONNECT:1,OFF:9999},w={GROUP_MSG:1,C2C_MSG:2,USER_HEAD:3,GROUP_HEAD:4},x={ING:14,STOP:15},q=10,B=D.INIT,Y=!1,K=0,H=6e4,J=5e3,V=60008,z=91101,X=10018,j=null,$=0,Q=10,W=0,Z=20,ee=[],te=null,ne={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,tinyid:"null",identifierNick:null,userSig:null,a2:null,contentType:"json",apn:1},oe={},re=0,ie={},se=0,ae=[],ue=[],ce=20,le=[],fe={downloadMap:{}},pe={"[Hai]":1,"[对不起]":2,"[委屈]":3,"[OK]":4,"[么么哒]":5,"[大哭]":6,"[无语]":7,"[哇哦]":8},ge={1:["[Hai]",n("02e2")],2:["[对不起]",n("03d0")],3:["[委屈]",n("ec34e")],4:["[OK]",n("99b5")],5:["[么么哒]",n("e56a")],6:["[大哭]",n("c1ee")],7:["[无语]",n("91a8")],8:["[哇哦]",n("1cc9")]},de=new function(){this.formatTimeStamp=function(e,t){if(!e)return 0;var n;t=t||"yyyy-MM-dd hh:mm:ss";var o=new Date(1e3*e),r={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds()};for(var i in n=/(y+)/.test(t)?t.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length)):t,r)new RegExp("("+i+")").test(n)&&(n=n.replace(RegExp.$1,1==RegExp.$1.length?r[i]:("00"+r[i]).substr((""+r[i]).length)));return n},this.groupTypeEn2Ch=function(e){var t=null;switch(e){case"Public":t="公开群";break;case"ChatRoom":t="聊天室";break;case"Private":t="私有群";break;case"AVChatRoom":t="直播聊天室";break;default:t=e;break}return t},this.groupTypeCh2En=function(e){var t=null;switch(e){case"公开群":t="Public";break;case"聊天室":t="ChatRoom";break;case"私有群":t="Private";break;case"直播聊天室":t="AVChatRoom";break;default:t=e;break}return t},this.groupRoleEn2Ch=function(e){var t=null;switch(e){case"Member":t="成员";break;case"Admin":t="管理员";break;case"Owner":t="群主";break;default:t=e;break}return t},this.groupRoleCh2En=function(e){var t=null;switch(e){case"成员":t="Member";break;case"管理员":t="Admin";break;case"群主":t="Owner";break;default:t=e;break}return t},this.groupMsgFlagEn2Ch=function(e){var t=null;switch(e){case"AcceptAndNotify":t="接收并提示";break;case"AcceptNotNotify":t="接收不提示";break;case"Discard":t="屏蔽";break;default:t=e;break}return t},this.groupMsgFlagCh2En=function(e){var t=null;switch(e){case"接收并提示":t="AcceptAndNotify";break;case"接收不提示":t="AcceptNotNotify";break;case"屏蔽":t="Discard";break;default:t=e;break}return t},this.formatText2Html=function(e){var t=e;return t&&(t=this.xssFilter(t),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\n/g,"<br/>")),t},this.formatHtml2Text=function(e){var t=e;return t&&(t=t.replace(/&nbsp;/g," "),t=t.replace(/<br\/>/g,"\n")),t},this.getStrBytes=function(e){if(null==e||void 0===e)return 0;if("string"!=typeof e)return 0;var t,n,o,r=0;for(n=0,o=e.length;n<o;n++)t=e.charCodeAt(n),r+=t<=127?1:t<=2047?2:t<=65535?3:4;return r},this.xssFilter=function(e){return e=e.toString(),e=e.replace(/[<]/g,"&lt;"),e=e.replace(/[>]/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e},this.trimStr=function(e){return e?(e=e.toString(),e.replace(/(^\s*)|(\s*$)/g,"")):""},this.validNumber=function(e){return e=e.toString(),e.match(/(^\d{1,8}$)/g)},this.getReturnError=function(e,t){t||(t=-100);var n={ActionStatus:I.FAIL,ErrorCode:t,ErrorInfo:e+"["+t+"]"};return n},this.replaceObject=function(e,t){for(var n in t)if(e[n])if(t[e[n]]=t[n],delete t[n],t[e[n]]instanceof Array)for(var o=t[e[n]].length,i=0;i<o;i++)t[e[n]][i]=this.replaceObject(e,t[e[n]][i]);else"object"===r()(t[e[n]])&&(t[e[n]]=this.replaceObject(e,t[e[n]]));return t}},me=new function(){var e=!0;this.setOn=function(t){e=t},this.getOn=function(){return e},this.error=function(e){},this.warn=function(e){},this.info=function(e){},this.debug=function(e){}},Ie=function(e){return e||(e=new Date),Math.round(e.getTime()/1e3)},_e=function(){return se?se+=1:se=Math.round(1e7*Math.random()),se},Me=function(){return Math.round(4294967296*Math.random())},Ee=function(e,t,n,o,r,i,s){a.a.post(t,n).then(function(e){K=$=0,i&&i(e.data)}).catch(function(e){setTimeout(function(){var e="请求服务器失败,请检查你的网络是否正常",t=de.getReturnError(e,-2);s&&s(t)},16)})},Te=function(e,t,n,o,r,i,s){Ee(e,t,JSON.stringify(n),o,r,function(e){var t=null;e&&(t=e),i&&i(t)},s)},he=function(){return ne.sdkAppID&&ne.identifier},ye=function(e,t){if(!he()){if(t){var n="请登录",o=de.getReturnError(n,-4);e&&e(o)}return!1}return!0},Se=function(){return o},Ce=function(e,n,o,r){var i=s;i=Se()?s.FORMAL.COMMON:s.TEST.COMMON,e==l.PIC&&(i=Se()?s.FORMAL.PIC:s.TEST.PIC);var a=i+"/"+f[e]+"/"+e+"/"+n+"?websdkappid="+t.APPID+"&v="+t.VERSION+"&platform="+t.PLAATFORM;if(he()){if("login"==n||"accesslayer"==n)a+="&identifier="+encodeURIComponent(ne.identifier)+"&usersig="+ne.userSig;else if(ne.tinyid&&ne.a2)a+="&tinyid="+ne.tinyid+"&a2="+ne.a2;else if(r)return me.error("tinyid或a2为空["+e+"]["+n+"]"),r(de.getReturnError("tinyid或a2为空["+e+"]["+n+"]",-5)),!1;a+="&contenttype="+ne.contentType}return a+="&sdkappid="+ne.sdkAppID+"&accounttype="+ne.accountType+"&apn="+ne.apn+"&reqtime="+Ie(),a},Ae=function(e,t){var n=null;return te&&ee[0]?n="https://"+y.SOUND_SERVER_DOMAIN+"/asn.com/stddownload_common_file?authkey="+te+"&bid="+y.BUSSINESS_ID+"&subbid="+ne.sdkAppID+"&fileid="+e+"&filetype="+S.SOUND+"&openid="+t+"&ver=0":me.error("拼接语音下载url不报错：ip或者authkey为空"),n},Ge=function(e,t,n){var o=null;return te&&ee[0]?o="http://"+ee[0]+"/asn.com/stddownload_common_file?authkey="+te+"&bid="+y.BUSSINESS_ID+"&subbid="+ne.sdkAppID+"&fileid="+e+"&filetype="+S.FILE+"&openid="+t+"&ver=0&filename="+encodeURIComponent(n):me.error("拼接文件下载url不报错：ip或者authkey为空"),fe.downloadMap["uuid_"+e]=o,o},Oe=function(e,t,n,o,r,i,s){var a={From_Account:t,To_Account:r,os_platform:10,Timestamp:Ie().toString(),Random:Me().toString(),request_info:[{busi_id:i,download_flag:o,type:s,uuid:e,version:A.SERVER_VERSION,auth_key:te,ip:ee[0]}]};Ut(a,function(e){0==e.error_code&&e.response_info&&(fe.downloadMap["uuid_"+a.uuid]=e.response_info.url),onAppliedDownloadUrl&&onAppliedDownloadUrl({uuid:a.uuid,url:e.response_info.url,maps:fe.downloadMap})},function(e){me.error("获取下载地址失败",a.uuid)})},Pe=function(){for(var e in ie){var t=ie[e];t&&(t.abort(),ie[re]=null)}re=0,ie={}},Ne=function(){Pe(),ne={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,identifierNick:null,userSig:null,contentType:"json",apn:1},oe={},se=0,le=[],qt.clear(),xt.clear(),j=null},ve=function(e,t,n,r,i){Ne(),n&&(oe=n),0==oe.isAccessFormalEnv&&(me.error("请切换为正式环境！！！！"),o=oe.isAccessFormalEnv),0==oe.isLogOn&&me.setOn(oe.isLogOn),e||!i?e.sdkAppID||!i?e.accountType||!i?(e.identifier&&(ne.identifier=e.identifier.toString()),e.identifier&&!e.userSig&&i?i(de.getReturnError("loginInfo.userSig is empty",-9)):(e.userSig&&(ne.userSig=e.userSig.toString()),ne.sdkAppID=e.sdkAppID,ne.accountType=e.accountType,ne.identifier&&ne.userSig?be(function(){Ue(function(e,n){qt.init(t,function(t){r&&(t.identifierNick=e,t.headurl=n,r(t))},i)},i)}):qt.init(t,r,i))):i(de.getReturnError("loginInfo.accountType is empty",-8)):i(de.getReturnError("loginInfo.sdkAppID is empty",-7)):i(de.getReturnError("loginInfo is empty",-6))},Fe=function(){c="wechat"},Re=function(e,n,o){if("longpolling"!=e||n!=V&&n!=z){var r=p[e];if(r){var i=Ie(),s=null,a={Code:n,ErrMsg:o};if(ne.a2?s=ne.a2.substring(0,10)+"_"+i+"_"+Me():ne.userSig&&(s=ne.userSig.substring(0,10)+"_"+i+"_"+Me()),s){var u={UniqKey:s,EventId:r,ReportTime:i,MsgCmdErrorCode:a};if("login"==e){var c=[];c.push(u);var l={EvtItems:c,MainVersion:t.VERSION,Version:"0"};Rt(l,function(e){c=null},function(e){c=null})}else if(le.push(u),le.length>=ce){var f={EvtItems:le,MainVersion:t.VERSION,Version:"0"};Rt(f,function(e){le=[]},function(e){le=[]})}}}}},be=function(e){Lt.apiCall(l.WEB_IM,"accesslayer",{},function(t){0===t.ErrorCode&&1===t.WebImAccessLayer&&(s.FORMAL.COMMON="https://events.tim.qq.com"),e()},function(){e()})},Ue=function(e,t){Lt.apiCall(l.OPEN_IM,"login",{State:"Online"},function(n){if(n.TinyId)ne.tinyid=n.TinyId;else if(t)return void t(de.getReturnError("TinyId is empty",-10));if(n.A2Key)ne.a2=n.A2Key;else if(t)return void t(de.getReturnError("A2Key is empty",-11));var o=["Tag_Profile_IM_Nick","Tag_Profile_IM_Image"],r={From_Account:ne.identifier,To_Account:[ne.identifier],LastStandardSequence:0,TagList:o};Ct(r,function(t){var n,o;if(t.UserProfileItem&&t.UserProfileItem.length>0)for(var r in t.UserProfileItem)for(var i in t.UserProfileItem[r].ProfileItem)switch(t.UserProfileItem[r].ProfileItem[i].Tag){case"Tag_Profile_IM_Nick":n=t.UserProfileItem[r].ProfileItem[i].Value,n&&(ne.identifierNick=n);break;case"Tag_Profile_IM_Image":o=t.UserProfileItem[r].ProfileItem[i].Value,o&&(ne.headurl=o);break}e&&e(ne.identifierNick,ne.headurl)},t)},t)},Le=function(e,t,n){if(!ye(n,!1))return Ne(),void(t&&t({ActionStatus:I.OK,ErrorCode:0,ErrorInfo:"logout success"}));"all"==e?Lt.apiCall(l.OPEN_IM,"logout",{},function(e){Ne(),t&&t(e)},n):Lt.apiCall(l.OPEN_IM,"longpollinglogout",{LongPollingId:j},function(e){Ne(),t&&t(e)},n)},ke=function(e,t,n){if(ye(n,!0)){var o=null;switch(e.sess.type()){case g.C2C:o={From_Account:ne.identifier,To_Account:e.sess.id().toString(),MsgTimeStamp:e.time,MsgSeq:e.seq,MsgRandom:e.random,MsgBody:[],OfflinePushInfo:e.offlinePushInfo};break;case g.GROUP:var r=e.getSubType();switch(o={GroupId:e.sess.id().toString(),From_Account:ne.identifier,Random:e.random,MsgBody:[]},r){case N.COMMON:o.MsgPriority="COMMON";break;case N.REDPACKET:o.MsgPriority="REDPACKET";break;case N.LOVEMSG:o.MsgPriority="LOVEMSG";break;case N.TIP:me.error("不能主动发送群提示消息,subType="+r);break;default:return void me.error("发送群消息时，出现未知子消息类型：subType="+r)}break;default:break}for(var i in e.elems){var s=e.elems[i],a=null,u=s.type;switch(u){case M.TEXT:a={Text:s.content.text};break;case M.FACE:a={Index:s.content.index,Data:s.content.data};break;case M.IMAGE:var c=[];for(var f in s.content.ImageInfoArray)c.push({Type:s.content.ImageInfoArray[f].type,Size:s.content.ImageInfoArray[f].size,Width:s.content.ImageInfoArray[f].width,Height:s.content.ImageInfoArray[f].height,URL:s.content.ImageInfoArray[f].url});a={ImageFormat:s.content.ImageFormat,UUID:s.content.UUID,ImageInfoArray:c};break;case M.SOUND:me.warn("web端暂不支持发送语音消息");continue;case M.LOCATION:me.warn("web端暂不支持发送地理位置消息");continue;case M.FILE:a={UUID:s.content.uuid,FileName:s.content.name,FileSize:s.content.size,DownloadFlag:s.content.downFlag};break;case M.CUSTOM:a={Data:s.content.data,Desc:s.content.desc,Ext:s.content.ext},u=M.CUSTOM;break;default:me.warn("web端暂不支持发送"+s.type+"消息");continue}e.PushInfoBoolean&&(o.OfflinePushInfo=e.PushInfo),o.MsgBody.push({MsgType:u,MsgContent:a})}e.sess.type()==g.C2C?Lt.apiCall(l.OPEN_IM,"sendmsg",o,t,n):e.sess.type()==g.GROUP&&Lt.apiCall(l.GROUP,"send_group_msg",o,t,n)}},De=function(e,t,n){(o||"undefined"==typeof stopPolling||1!=stopPolling)&&ye(n,!0)&&Lt.apiCall(l.OPEN_IM,"longpolling",e,t,n,H,!0)},we=function(e,t,n,o){Lt.apiCall(l.BIG_GROUP_LONG_POLLING,"get_msg",e,t,n,o)},xe=function e(t,n,o,r){ye(r,!0)&&Lt.apiCall(l.OPEN_IM,"getmsg",{Cookie:t,SyncFlag:n},function(t){if(t.MsgList&&t.MsgList.length)for(var n in t.MsgList)ae.push(t.MsgList[n]);1==t.SyncFlag?e(t.Cookie,t.SyncFlag,o,r):(t.MsgList=ae,ae=[],o&&o(t))},r)},qe=function(e,t,n,o){if(ye(o,!0)){var r=[];for(var i in t){var s={To_Account:t[i].toAccount,LastedMsgTime:t[i].lastedMsgTime};r.push(s)}Lt.apiCall(l.OPEN_IM,"msgreaded",{C2CMsgReaded:{Cookie:e,C2CMsgReadedItem:r}},n,o)}},Be=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.OPEN_IM,"deletemsg",e,t,n)},Ye=function e(t,n,o){ye(o,!0)&&Lt.apiCall(l.OPEN_IM,"getroammsg",t,function(r){var i=t.MaxCnt,s=r.Complete,a=r.MaxCnt,u=r.MsgKey,c=r.LastMsgTime;if(r.MsgList&&r.MsgList.length)for(var l in r.MsgList)ue.push(r.MsgList[l]);var f=null;0==s&&a<i&&(f={Peer_Account:t.Peer_Account,MaxCnt:i-a,LastMsgTime:c,MsgKey:u}),f?e(f,n,o):(r.MsgList=ue,ue=[],n&&n(r))},o)},Ke=function(e,t,n){if(ye(n,!0)){for(var o={Type:e.Type,Name:e.Name},r=[],i=0;i<e.MemberList.length;i++)r.push({Member_Account:e.MemberList[i]});o.MemberList=r,e.GroupId&&(o.GroupId=e.GroupId),e.Owner_Account&&(o.Owner_Account=e.Owner_Account),e.Introduction&&(o.Introduction=e.Introduction),e.Notification&&(o.Notification=e.Notification),e.MaxMemberCount&&(o.MaxMemberCount=e.MaxMemberCount),e.ApplyJoinOption&&(o.ApplyJoinOption=e.ApplyJoinOption),e.AppDefinedData&&(o.AppDefinedData=e.AppDefinedData),e.FaceUrl&&(o.FaceUrl=e.FaceUrl),Lt.apiCall(l.GROUP,"create_group",o,t,n)}},He=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"create_group",e,t,n)},Je=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"modify_group_base_info",e,t,n)},Ve=function(e,t,n){ye(n,!0)&&(e.GroupId=String(e.GroupId),Lt.apiCall(l.GROUP,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},t,n))},ze=function(e,t,n){var o;e.GroupId=String(e.GroupId),o=ye(n,!1)?l.GROUP:l.BIG_GROUP,qt.checkBigGroupLongPollingOn(e.GroupId)?n&&n(de.getReturnError("Join Group failed; You have already been in this group, you have to quit group before you rejoin",10013)):Lt.apiCall(o,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},function(o){if(o.JoinedStatus&&"JoinedSuccess"==o.JoinedStatus){if(!o.LongPollingKey)return void(n&&n(de.getReturnError("Join Group succeed; But the type of group is not AVChatRoom: groupid="+e.GroupId,-12)));qt.setBigGroupLongPollingOn(!0),qt.setBigGroupLongPollingKey(e.GroupId,o.LongPollingKey),qt.setBigGroupLongPollingMsgMap(e.GroupId,0),qt.bigGroupLongPolling(e.GroupId)}t&&t(o)},function(e){n&&n(e)})},Xe=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"handle_apply_join_group",{GroupId:e.GroupId,Applicant_Account:e.Applicant_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){if(10024==e.ErrorCode){if(t){var o={ActionStatus:I.OK,ErrorCode:0,ErrorInfo:"该申请已经被处理过"};t(o)}}else n&&n(e)})},je=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"get_pendency",{StartTime:e.StartTime,Limit:e.Limit,Handle_Account:ne.identifier},t,function(e){})},$e=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"report_pendency",{ReportTime:e.ReportTime,From_Account:ne.identifier},t,function(e){})},Qe=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"handle_invite_join_group",{GroupId:e.GroupId,Inviter_Account:e.Inviter_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){})},We=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"quit_group",{GroupId:e.GroupId},t,n)},Ze=function(e,t,n){var o;o=ye(n,!1)?l.GROUP:l.BIG_GROUP,qt.resetBigGroupLongPollingInfo(e.GroupId),Lt.apiCall(o,"quit_group",{GroupId:e.GroupId},function(n){xt.delSessByTypeId(g.GROUP,e.GroupId),t&&t(n)},n)},et=function(e,t,n){Lt.apiCall(l.GROUP,"search_group",e,t,n)},tt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"get_group_public_info",{GroupIdList:e.GroupIdList,ResponseFilter:{GroupBasePublicInfoFilter:e.GroupBasePublicInfoFilter}},function(e){if(e.ErrorInfo="",e.GroupInfo)for(var o in e.GroupInfo){var r=e.GroupInfo[o].ErrorCode;r>0&&(e.ActionStatus=I.FAIL,e.GroupInfo[o].ErrorInfo="["+r+"]"+e.GroupInfo[o].ErrorInfo,e.ErrorInfo+=e.GroupInfo[o].ErrorInfo+"\n")}e.ActionStatus==I.FAIL?n&&n(e):t&&t(e)},n)},nt=function(e,t,n){if(ye(n,!0)){var o={GroupIdList:e.GroupIdList,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,MemberInfoFilter:e.MemberInfoFilter}};e.AppDefinedDataFilter_Group&&(o.ResponseFilter.AppDefinedDataFilter_Group=e.AppDefinedDataFilter_Group),e.AppDefinedDataFilter_GroupMember&&(o.ResponseFilter.AppDefinedDataFilter_GroupMember=e.AppDefinedDataFilter_GroupMember),Lt.apiCall(l.GROUP,"get_group_info",o,t,n)}},ot=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"get_group_member_info",{GroupId:e.GroupId,Offset:e.Offset,Limit:e.Limit,MemberInfoFilter:e.MemberInfoFilter,MemberRoleFilter:e.MemberRoleFilter,AppDefinedDataFilter_GroupMember:e.AppDefinedDataFilter_GroupMember},t,n)},rt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"add_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberList:e.MemberList},t,n)},it=function(e,t,n){if(ye(n,!0)){var o={};e.GroupId&&(o.GroupId=e.GroupId),e.Member_Account&&(o.Member_Account=e.Member_Account),e.Role&&(o.Role=e.Role),e.MsgFlag&&(o.MsgFlag=e.MsgFlag),e.ShutUpTime&&(o.ShutUpTime=e.ShutUpTime),e.NameCard&&(o.NameCard=e.NameCard),e.AppMemberDefinedData&&(o.AppMemberDefinedData=e.AppMemberDefinedData),Lt.apiCall(l.GROUP,"modify_group_member_info",o,t,n)}},st=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"delete_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberToDel_Account:e.MemberToDel_Account,Reason:e.Reason},t,n)},at=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"destroy_group",{GroupId:e.GroupId},t,n)},ut=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"change_group_owner",e,t,n)},ct=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"get_joined_group_list",{Member_Account:e.Member_Account,Limit:e.Limit,Offset:e.Offset,GroupType:e.GroupType,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,SelfInfoFilter:e.SelfInfoFilter}},t,n)},lt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"get_role_in_group",{GroupId:e.GroupId,User_Account:e.User_Account},t,n)},ft=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"forbid_send_msg",{GroupId:e.GroupId,Members_Account:e.Members_Account,ShutUpTime:e.ShutUpTime},t,n)},pt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"send_group_system_notification",e,t,n)},gt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"group_msg_get",{GroupId:e.GroupId,ReqMsgSeq:e.ReqMsgSeq,ReqMsgNumber:e.ReqMsgNumber},t,n)},dt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.GROUP,"msg_read_report",{GroupId:e.GroupId,MsgReadedSeq:e.MsgReadedSeq},t,n)},mt=function(e){var t=[];if(e.Fail_Account&&e.Fail_Account.length&&(t=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var n in e.Invalid_Account)t.push(e.Invalid_Account[n]);if(t.length)for(var o in e.ActionStatus=I.FAIL,e.ErrorCode=_,e.ErrorInfo="",t){var r=t[o];for(var i in e.ResultItem)if(e.ResultItem[i].To_Account==r){var s=e.ResultItem[i].ResultCode;e.ResultItem[i].ResultInfo="["+s+"]"+e.ResultItem[i].ResultInfo,e.ErrorInfo+=e.ResultItem[i].ResultInfo+"\n";break}}return e},It=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"friend_add",{From_Account:ne.identifier,AddFriendItem:e.AddFriendItem},function(e){var o=mt(e);o.ActionStatus==I.FAIL?n&&n(o):t&&t(o)},n)},_t=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"friend_delete",{From_Account:ne.identifier,To_Account:e.To_Account,DeleteType:e.DeleteType},function(e){var o=mt(e);o.ActionStatus==I.FAIL?n&&n(o):t&&t(o)},n)},Mt=function(e,t,n){ye(n,!0)&&(1==e.chatType?Lt.apiCall(l.DEL_CHAT,"delete",{From_Account:ne.identifier,Type:e.chatType,To_Account:e.To_Account},t,n):Lt.apiCall(l.DEL_CHAT,"delete",{From_Account:ne.identifier,Type:e.chatType,ToGroupid:e.To_Account},t,n))},Et=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"pendency_get",{From_Account:ne.identifier,PendencyType:e.PendencyType,StartTime:e.StartTime,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)},Tt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"PendencyReport",{From_Account:ne.identifier,LatestPendencyTimeStamp:e.LatestPendencyTimeStamp},t,n)},ht=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"pendency_delete",{From_Account:ne.identifier,PendencyType:e.PendencyType,To_Account:e.To_Account},function(e){var o=mt(e);o.ActionStatus==I.FAIL?n&&n(o):t&&t(o)},n)},yt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"friend_response",{From_Account:ne.identifier,ResponseFriendItem:e.ResponseFriendItem},function(e){var o=mt(e);o.ActionStatus==I.FAIL?n&&n(o):t&&t(o)},n)},St=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"friend_get_all",{From_Account:ne.identifier,TimeStamp:e.TimeStamp,StartIndex:e.StartIndex,GetCount:e.GetCount,LastStandardSequence:e.LastStandardSequence,TagList:e.TagList},t,n)},Ct=function(e,t,n){e.To_Account.length>100&&(e.To_Account.length=100,me.error("获取用户资料人数不能超过100人")),ye(n,!0)&&Lt.apiCall(l.PROFILE,"portrait_get",{From_Account:ne.identifier,To_Account:e.To_Account,TagList:e.TagList},function(e){var o=[];if(e.Fail_Account&&e.Fail_Account.length&&(o=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var r in e.Invalid_Account)o.push(e.Invalid_Account[r]);if(o.length)for(var i in e.ActionStatus=I.FAIL,e.ErrorCode=_,e.ErrorInfo="",o){var s=o[i];for(var a in e.UserProfileItem)if(e.UserProfileItem[a].To_Account==s){var u=e.UserProfileItem[a].ResultCode;e.UserProfileItem[a].ResultInfo="["+u+"]"+e.UserProfileItem[a].ResultInfo,e.ErrorInfo+="账号:"+s+","+e.UserProfileItem[a].ResultInfo+"\n";break}}e.ActionStatus==I.FAIL?n&&n(e):t&&t(e)},n)},At=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.PROFILE,"portrait_set",{From_Account:ne.identifier,ProfileItem:e.ProfileItem},function(n){for(var o in e.ProfileItem){var r=e.ProfileItem[o];if("Tag_Profile_IM_Nick"==r.Tag){ne.identifierNick=r.Value;break}}t&&t(n)},n)},Gt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"black_list_add",{From_Account:ne.identifier,To_Account:e.To_Account},function(e){var o=mt(e);o.ActionStatus==I.FAIL?n&&n(o):t&&t(o)},n)},Ot=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"black_list_delete",{From_Account:ne.identifier,To_Account:e.To_Account},function(e){var o=mt(e);o.ActionStatus==I.FAIL?n&&n(o):t&&t(o)},n)},Pt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.FRIEND,"black_list_get",{From_Account:ne.identifier,StartIndex:e.StartIndex,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)},Nt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.RECENT_CONTACT,"get",{From_Account:ne.identifier,Count:e.Count},t,n)},vt=function(e,t,n){var o;ye(n,!0)&&(o=Se()?"pic_up":"pic_up_test",Lt.apiCall(l.PIC,o,{App_Version:A.APP_VERSION,From_Account:ne.identifier,To_Account:e.To_Account,Seq:e.Seq,Timestamp:e.Timestamp,Random:e.Random,File_Str_Md5:e.File_Str_Md5,File_Size:e.File_Size,File_Type:e.File_Type,Server_Ver:A.SERVER_VERSION,Auth_Key:te,Busi_Id:e.Busi_Id,PkgFlag:e.PkgFlag,Slice_Offset:e.Slice_Offset,Slice_Size:e.Slice_Size,Slice_Data:e.Slice_Data},t,n))},Ft=function(e,t){ye(t,!0)&&Lt.apiCall(l.OPEN_IM,"authkey",{},e,t)},Rt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.IM_OPEN_STAT,"web_report",e,t,n)},bt=function(e,t,n){ye(n,!0)&&Lt.apiCall(l.OPEN_IM,"getlongpollingid",{},function(e){t&&t(e)},n)},Ut=function(e,t,n){Lt.apiCall(l.PIC,"apply_download",e,t,n)};Fe();var Lt=new function(){var e=null;this.init=function(t,n,o){t&&(e=t)},this.callBack=function(t){e&&e(t)},this.clear=function(){e=null},this.apiCall=function(e,t,n,o,r,i,s){var a=Ce(e,t,o,r);0!=a&&Te("POST",a,n,i,s,function(i){var s=null,u="";"pic_up"==t&&(n.Slice_Data="");var c="\n request url: \n"+a+"\n request body: \n"+JSON.stringify(n)+"\n response: \n"+JSON.stringify(i);i.ActionStatus==I.OK?(me.info("["+e+"]["+t+"]success: "+c),o&&o(i),s=0,u=""):(s=i.ErrorCode,u=i.ErrorInfo,r&&(i.SrcErrorInfo=i.ErrorInfo,i.ErrorInfo="["+e+"]["+t+"]failed: "+c,"longpolling"==t&&i.ErrorCode==V||me.error(i.ErrorInfo),r(i))),Re(t,s,u)},function(e){r&&r(e),Re(t,e.ErrorCode,e.ErrorInfo)})}},kt=function e(t,n,o,r,i,s){this._impl={skey:e.skey(t,n),type:t,id:n,name:o,icon:r,unread:0,isAutoRead:!1,time:i>=0?i:0,curMaxMsgSeq:s>=0?s:0,msgs:[],isFinished:1}};kt.skey=function(e,t){return e+t},kt.prototype.type=function(){return this._impl.type},kt.prototype.id=function(){return this._impl.id},kt.prototype.name=function(){return this._impl.name},kt.prototype.icon=function(){return this._impl.icon},kt.prototype.unread=function(e){if("undefined"===typeof e)return this._impl.unread;this._impl.unread=e},kt.prototype.isFinished=function(e){if("undefined"===typeof e)return this._impl.isFinished;this._impl.isFinished=e},kt.prototype.time=function(){return this._impl.time},kt.prototype.curMaxMsgSeq=function(e){if("undefined"===typeof e)return this._impl.curMaxMsgSeq;this._impl.curMaxMsgSeq=e},kt.prototype.msgCount=function(){return this._impl.msgs.length},kt.prototype.msg=function(e){return this._impl.msgs[e]},kt.prototype.msgs=function(){return this._impl.msgs},kt.prototype._impl_addMsg=function(e,t){this._impl.msgs.push(e),e.time>this._impl.time&&(this._impl.time=e.time),e.seq>this._impl.curMaxMsgSeq&&(this._impl.curMaxMsgSeq=e.seq),e.isSend||this._impl.isAutoRead||!t||this._impl.unread++};var Dt=function(e,t){this.toAccount=e,this.lastedMsgTime=t},wt=function(e,t,n,o,r,i,s,a,u){this.sess=e,this.subType=s>=0?s:0,this.fromAccount=i,this.fromAccountNick=a||i,this.fromAccountHeadurl=u||null,this.isSend=Boolean(t),this.seq=n>=0?n:_e(),this.random=o>=0?o:Me(),this.time=r>=0?r:Ie(),this.elems=[];var c=e.type();switch(c){case g.GROUP:break;case g.C2C:default:break}};wt.prototype.getSession=function(){return this.sess},wt.prototype.getType=function(){return this.subType},wt.prototype.getSubType=function(){return this.subType},wt.prototype.getFromAccount=function(){return this.fromAccount},wt.prototype.getFromAccountNick=function(){return this.fromAccountNick},wt.prototype.getIsSend=function(){return this.isSend},wt.prototype.getSeq=function(){return this.seq},wt.prototype.getTime=function(){return this.time},wt.prototype.getRandom=function(){return this.random},wt.prototype.getElems=function(){return this.elems},wt.prototype.getMsgUniqueId=function(){return this.uniqueId},wt.prototype.addText=function(t){this.addElem(new e.Msg.Elem(M.TEXT,t))},wt.prototype.addFace=function(t){this.addElem(new e.Msg.Elem(M.FACE,t))},wt.prototype.addImage=function(t){this.addElem(new e.Msg.Elem(M.IMAGE,t))},wt.prototype.addLocation=function(t){this.addElem(new e.Msg.Elem(M.LOCATION,t))},wt.prototype.addFile=function(t){this.addElem(new e.Msg.Elem(M.FILE,t))},wt.prototype.addCustom=function(t){this.addElem(new e.Msg.Elem(M.CUSTOM,t))},wt.prototype.addElem=function(e){this.elems.push(e)},wt.prototype.toHtml=function(){var e="";for(var t in this.elems){var n=this.elems[t];e+=n.toHtml()}return e},wt.Elem=function(e,t){this.type=e,this.content=t},wt.Elem.prototype.getType=function(){return this.type},wt.Elem.prototype.getContent=function(){return this.content},wt.Elem.prototype.toHtml=function(){var e;return e=this.content.toHtml(),e},wt.Elem.Text=function(e){this.text=de.xssFilter(e)},wt.Elem.Text.prototype.getText=function(){return this.text},wt.Elem.Text.prototype.toHtml=function(){return this.text},wt.Elem.Face=function(e,t){this.index=e,this.data=t},wt.Elem.Face.prototype.getIndex=function(){return this.index},wt.Elem.Face.prototype.getData=function(){return this.data},wt.Elem.Face.prototype.toHtml=function(){var e=null,t=pe[this.data],n=ge[t];return n&&n[1]&&(e=n[1]),e?"<img src='"+e+"'/>":this.data},wt.Elem.Location=function(e,t,n){this.latitude=t,this.longitude=e,this.desc=n},wt.Elem.Location.prototype.getLatitude=function(){return this.latitude},wt.Elem.Location.prototype.getLongitude=function(){return this.longitude},wt.Elem.Location.prototype.getDesc=function(){return this.desc},wt.Elem.Location.prototype.toHtml=function(){return"经度="+this.longitude+",纬度="+this.latitude+",描述="+this.desc},wt.Elem.Images=function(e,t){this.UUID=e,"number"!==typeof t&&(t=parseInt(T[t]||T["UNKNOWN"],10)),this.ImageFormat=t,this.ImageInfoArray=[]},wt.Elem.Images.prototype.addImage=function(e){this.ImageInfoArray.push(e)},wt.Elem.Images.prototype.toHtml=function(){var e=this.getImage(E.SMALL),t=this.getImage(E.LARGE),n=this.getImage(E.ORIGIN);return t||(t=e),n||(n=e),"<img src='"+e.getUrl()+"#"+t.getUrl()+"#"+n.getUrl()+"' style='CURSOR: hand' id='"+this.getImageId()+"' bigImgUrl='"+t.getUrl()+"' onclick='imageClick(this)' />"},wt.Elem.Images.prototype.getImageId=function(){return this.UUID},wt.Elem.Images.prototype.getImageFormat=function(){return this.ImageFormat},wt.Elem.Images.prototype.getImage=function(e){for(var t in this.ImageInfoArray)if(this.ImageInfoArray[t].getType()==e)return this.ImageInfoArray[t];var n=null;return this.ImageInfoArray.forEach(function(t){t.getType()==e&&(n=t)}),n},wt.Elem.Images.Image=function(e,t,n,o,r){this.type=e,this.size=t,this.width=n,this.height=o,this.url=r},wt.Elem.Images.Image.prototype.getType=function(){return this.type},wt.Elem.Images.Image.prototype.getSize=function(){return this.size},wt.Elem.Images.Image.prototype.getWidth=function(){return this.width},wt.Elem.Images.Image.prototype.getHeight=function(){return this.height},wt.Elem.Images.Image.prototype.getUrl=function(){return this.url},wt.Elem.Sound=function(e,t,n,o,r,i,s){this.uuid=e,this.second=t,this.size=n,this.senderId=o,this.receiverId=r,this.downFlag=i,this.busiId=s==g.C2C?2:1,void 0!==this.downFlag&&void 0!==this.busiId?Oe(e,o,t,i,r,this.busiId,C.SOUND):this.downUrl=Ae(e,o,t)},wt.Elem.Sound.prototype.getUUID=function(){return this.uuid},wt.Elem.Sound.prototype.getSecond=function(){return this.second},wt.Elem.Sound.prototype.getSize=function(){return this.size},wt.Elem.Sound.prototype.getSenderId=function(){return this.senderId},wt.Elem.Sound.prototype.getDownUrl=function(){return this.downUrl},wt.Elem.Sound.prototype.toHtml=function(){return"ie"==c.type&&parseInt(c.ver)<=8?"[这是一条语音消息]demo暂不支持ie8(含)以下浏览器播放语音,语音URL:"+this.downUrl:'<audio id="uuid_'+this.uuid+'" src="'+this.downUrl+'" controls="controls" onplay="onChangePlayAudio(this)" preload="none"></audio>'},wt.Elem.File=function(e,t,n,o,r,i,s){this.uuid=e,this.name=t,this.size=n,this.senderId=o,this.receiverId=r,this.downFlag=i,this.busiId=s==g.C2C?2:1,void 0!==i&&void 0!==busiId?Oe(e,o,t,i,r,this.busiId,C.FILE):this.downUrl=Ge(e,o,t)},wt.Elem.File.prototype.getUUID=function(){return this.uuid},wt.Elem.File.prototype.getName=function(){return this.name},wt.Elem.File.prototype.getSize=function(){return this.size},wt.Elem.File.prototype.getSenderId=function(){return this.senderId},wt.Elem.File.prototype.getDownUrl=function(){return this.downUrl},wt.Elem.File.prototype.getDownFlag=function(){return this.downFlag},wt.Elem.File.prototype.toHtml=function(){var e,t;return e=this.size,t="Byte",this.size>=1024&&(e=Math.round(this.size/1024),t="KB"),{uuid:this.uuid,name:this.name,size:e,unitStr:t}},wt.Elem.GroupTip=function(e,t,n,o,r,i){this.opType=e,this.opUserId=t,this.groupId=n,this.groupName=o,this.userIdList=r||[],this.groupInfoList=[],this.memberInfoList=[],this.groupMemberNum=null,this.userinfo=i||[]},wt.Elem.GroupTip.prototype.addGroupInfo=function(e){this.groupInfoList.push(e)},wt.Elem.GroupTip.prototype.addMemberInfo=function(e){this.memberInfoList.push(e)},wt.Elem.GroupTip.prototype.getOpType=function(){return this.opType},wt.Elem.GroupTip.prototype.getOpUserId=function(){return this.opUserId},wt.Elem.GroupTip.prototype.getGroupId=function(){return this.groupId},wt.Elem.GroupTip.prototype.getGroupName=function(){return this.groupName},wt.Elem.GroupTip.prototype.getUserIdList=function(){return this.userIdList},wt.Elem.GroupTip.prototype.getUserInfo=function(){return this.userinfo},wt.Elem.GroupTip.prototype.getGroupInfoList=function(){return this.groupInfoList},wt.Elem.GroupTip.prototype.getMemberInfoList=function(){return this.memberInfoList},wt.Elem.GroupTip.prototype.getGroupMemberNum=function(){return this.groupMemberNum},wt.Elem.GroupTip.prototype.setGroupMemberNum=function(e){return this.groupMemberNum=e},wt.Elem.GroupTip.prototype.toHtml=function(){var e="[群提示消息]",t=q-1;switch(this.opType){case F.JOIN:for(var n in e+=this.opUserId+"邀请了",this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>q&&n==t){e+="等"+this.userIdList.length+"人";break}e+="加入该群";break;case F.QUIT:e+=this.opUserId+"主动退出该群";break;case F.KICK:for(var n in e+=this.opUserId+"将",this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>q&&n==t){e+="等"+this.userIdList.length+"人";break}e+="踢出该群";break;case F.SET_ADMIN:for(var n in e+=this.opUserId+"将",this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>q&&n==t){e+="等"+this.userIdList.length+"人";break}e+="设为管理员";break;case F.CANCEL_ADMIN:for(var n in e+=this.opUserId+"取消",this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>q&&n==t){e+="等"+this.userIdList.length+"人";break}e+="的管理员资格";break;case F.MODIFY_GROUP_INFO:for(var n in e+=this.opUserId+"修改了群资料：",this.groupInfoList){var o=this.groupInfoList[n].getType(),r=this.groupInfoList[n].getValue();switch(o){case R.FACE_URL:e+="群头像为"+r+"; ";break;case R.NAME:e+="群名称为"+r+"; ";break;case R.OWNER:e+="群主为"+r+"; ";break;case R.NOTIFICATION:e+="群公告为"+r+"; ";break;case R.INTRODUCTION:e+="群简介为"+r+"; ";break;default:e+="未知信息为:type="+o+",value="+r+"; ";break}}break;case F.MODIFY_MEMBER_INFO:for(var n in e+=this.opUserId+"修改了群成员资料:",this.memberInfoList){var i=this.memberInfoList[n].getUserId(),s=this.memberInfoList[n].getShutupTime();if(e+=i+": ",e+=null!=s&&void 0!==s?0==s?"取消禁言; ":"禁言"+s+"秒; ":" shutupTime为空",this.memberInfoList.length>q&&n==t){e+="等"+this.memberInfoList.length+"人";break}}break;case F.READED:Log.info("消息已读同步");break;default:e+="未知群提示消息类型：type="+this.opType;break}return e},wt.Elem.GroupTip.GroupInfo=function(e,t){this.type=e,this.value=t},wt.Elem.GroupTip.GroupInfo.prototype.getType=function(){return this.type},wt.Elem.GroupTip.GroupInfo.prototype.getValue=function(){return this.value},wt.Elem.GroupTip.MemberInfo=function(e,t){this.userId=e,this.shutupTime=t},wt.Elem.GroupTip.MemberInfo.prototype.getUserId=function(){return this.userId},wt.Elem.GroupTip.MemberInfo.prototype.getShutupTime=function(){return this.shutupTime},wt.Elem.Custom=function(e,t,n){this.data=e,this.desc=t,this.ext=n},wt.Elem.Custom.prototype.getData=function(){return this.data},wt.Elem.Custom.prototype.getDesc=function(){return this.desc},wt.Elem.Custom.prototype.getExt=function(){return this.ext},wt.Elem.Custom.prototype.toHtml=function(){return this.data};var xt=new function(){var e={},t=[];u={},this.cookie="",this.syncFlag=0;var n=function(t){for(var n in e)t(e[n])},o=function(e){var t=!1,n=e.sess._impl.skey,o=e.isSend+e.seq+e.random,r=u[n]&&u[n][o];return r&&(t=!0),u[n]?u[n][o]={time:e.time}:(u[n]={},u[n][o]={time:e.time}),t};this.sessMap=function(){return e},this.sessCount=function(){return t.length},this.sessByTypeId=function(t,n){var o=kt.skey(t,n);return void 0===o||null==o?null:e[o]},this.delSessByTypeId=function(t,n){var o=kt.skey(t,n);return void 0!==o&&null!=o&&(e[o]&&(delete e[o],delete u[o]),!0)},this.resetCookieAndSyncFlag=function(){this.cookie="",this.syncFlag=0},this.setAutoRead=function(e,t,o){if(o&&n(function(e){e._impl.isAutoRead=!1}),e&&(e._impl.isAutoRead=t,t))if(e._impl.unread=0,e._impl.type==g.C2C){var r=[];r.push(new Dt(e._impl.id,e._impl.time)),qe(xt.cookie,r,function(e){me.info("[setAutoRead]: c2CMsgReaded success")},function(e){me.error("[setAutoRead}: c2CMsgReaded failed:"+e.ErrorInfo)})}else if(e._impl.type==g.GROUP){var i={GroupId:e._impl.id,MsgReadedSeq:e._impl.curMaxMsgSeq};dt(i,function(e){me.info("groupMsgReaded success")},function(e){me.error("groupMsgReaded failed:"+e.ErrorInfo)})}},this.c2CMsgReaded=function(e,t,n){var o=[];o.push(new Dt(e.To_Account,e.LastedMsgTime)),qe(xt.cookie,o,function(e){t&&(me.info("c2CMsgReaded success"),t(e))},function(e){n&&(me.error("c2CMsgReaded failed:"+e.ErrorInfo),n(e))})},this.addSession=function(t){e[t._impl.skey]=t},this.delSession=function(t){delete e[t._impl.skey]},this.clear=function(){e={},t=[],u={},this.cookie="",this.syncFlag=0},this.addMsg=function(t,n){if(o(t))return!1;var r=t.sess;return e[r._impl.skey]||this.addSession(r),r._impl_addMsg(t,n),!0},this.updateTimeline=function(){var e=new Array;n(function(t){e.push(t)}),e.sort(function(e,t){return t.time-e.time}),t=e}},qt=new function(){var e=null,t=null,n={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},r={1:null},i=null,s=!1,a=0,u=0,c=null,l=!1,f={},p=90,d=null,m={},_={92:null,96:null},E={},T={};this.setLongPollingOn=function(e){s=e},this.getLongPollingOn=function(){return s},this.resetLongPollingInfo=function(){s=!1,a=0,u=0},this.setBigGroupLongPollingOn=function(e){l=e},this.checkBigGroupLongPollingOn=function(e){return!!d[e]},this.setBigGroupLongPollingKey=function(e,t){d[e]=t},this.resetBigGroupLongPollingInfo=function(e){l=!1,f[e]=0,d[e]=null,m[e]={}},this.setBigGroupLongPollingMsgMap=function(e,t){var n=m[e];n?(n=parseInt(n)+t,m[e]=n):m[e]=t},this.clear=function(){t=null,n={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},r={1:null},e=null,s=!1,a=0,u=0,c=null,l=!1,f={},d={},m={},T={},ee=[],te=null,null};var h=function(e,t){Ft(function(t){ee=t.IpList,te=t.AuthKey,t.ExpireTime,e&&e(t)},function(e){me.error("initIpAndAuthkey failed:"+e.ErrorInfo),t&&t(e)})},y=function(e,t){var n={Member_Account:ne.identifier,Limit:1e3,Offset:0,GroupBaseInfoFilter:["NextMsgSeq"]};ct(n,function(t){if(!t.GroupIdList||0==t.GroupIdList.length)return me.info("initMyGroupMaxSeqs: 目前还没有加入任何群组"),void(e&&e(t));for(var n=0;n<t.GroupIdList.length;n++){var o=t.GroupIdList[n].GroupId,r=t.GroupIdList[n].NextMsgSeq-1;E[o]=r}e&&e(t)},function(e){me.error("initMyGroupMaxSeqs failed:"+e.ErrorInfo),t&&t(e)})},S=function(e,t){var n=E[e];n?t>n&&(E[e]=t):E[e]=t},C=function(e,t){for(var n in e){var o=e[n];if(o.From_Account){var r=ue(o,!1,!0);r&&t.push(r),S(o.ToGroupId,o.MsgSeq)}}return t},A=function(t,n){var o={},r=[],i=99999999,s=-1;for(var a in n){var c=o[n[a].ToGroupId];c||(c=o[n[a].ToGroupId]={min:i,max:s,msgs:[]}),n[a].NoticeSeq>u&&(me.warn("noticeSeq="+u+",msgNoticeSeq="+n[a].NoticeSeq),u=n[a].NoticeSeq),n[a].Event=t,o[n[a].ToGroupId].msgs.push(n[a]),n[a].MsgSeq<c.min&&(o[n[a].ToGroupId].min=n[a].MsgSeq),n[a].MsgSeq>c.max&&(o[n[a].ToGroupId].max=n[a].MsgSeq)}for(var l in o)r=C(o[l].msgs,r);r.length&&xt.updateTimeline(),e&&r.length&&e(r)},k=function(t,n){var o={},r=[],i=99999999,s=-1;for(var a in n){var c=o[n[a].ToGroupId];c||(c=o[n[a].ToGroupId]={min:i,max:s,msgs:[]}),n[a].NoticeSeq>u&&(me.warn("noticeSeq="+u+",msgNoticeSeq="+n[a].NoticeSeq),u=n[a].NoticeSeq),n[a].Event=t,o[n[a].ToGroupId].msgs.push(n[a]),n[a].MsgSeq<c.min&&(o[n[a].ToGroupId].min=n[a].MsgSeq),n[a].MsgSeq>c.max&&(o[n[a].ToGroupId].max=n[a].MsgSeq)}for(var l in o)r=C(o[l].msgs,r);r.length&&xt.updateTimeline(),e&&r.length&&e(r)},w=function(e,t){for(var o in e){var r=e[o],i=r.MsgBody,s=i.ReportType;0==t&&r.NoticeSeq&&r.NoticeSeq>u&&(u=r.NoticeSeq);r.GroupInfo.To_Account;if(t){var a=r.ToGroupId+"_"+s+"_"+i.Operator_Account,c=T[a];if(c){me.warn("收到重复的群系统消息：key="+a);continue}T[a]=!0}var l={SrcFlag:0,ReportType:s,GroupId:r.ToGroupId,GroupName:r.GroupInfo.GroupName,Operator_Account:i.Operator_Account,MsgTime:r.MsgTimeStamp,groupReportTypeMsg:i};switch(s){case b.JOIN_GROUP_REQUEST:l["RemarkInfo"]=i.RemarkInfo,l["MsgKey"]=i.MsgKey,l["Authentication"]=i.Authentication,l["UserDefinedField"]=r.UserDefinedField,l["From_Account"]=r.From_Account,l["MsgSeq"]=r.ClientSeq,l["MsgRandom"]=r.MsgRandom;break;case b.JOIN_GROUP_ACCEPT:case b.JOIN_GROUP_REFUSE:l["RemarkInfo"]=i.RemarkInfo;break;case b.KICK:case b.DESTORY:case b.CREATE:case b.INVITED_JOIN_GROUP_REQUEST:case b.INVITED_JOIN_GROUP_REQUEST_AGREE:case b.QUIT:case b.SET_ADMIN:case b.CANCEL_ADMIN:case b.REVOKE:break;case b.READED:break;case b.CUSTOM:l["MsgSeq"]=r.MsgSeq,l["UserDefinedField"]=i.UserDefinedField;break;default:me.error("未知群系统消息类型：reportType="+s);break}if(t)n[s]?n[s](l):me.error("未知群系统消息类型：reportType="+s);else if(n[s])if(s==b.READED)for(var f=l.groupReportTypeMsg.GroupReadInfoArray,p=0,g=f.length;p<g;p++){var d=f[p];n[s](d)}else n[s](l)}},q=function(e,t){var n,r,i;for(var s in e){switch(n=e[s],r=n.PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>u&&(u=n.NoticeSeq),i={Type:r},r){case U.FRIEND_ADD:i["Accounts"]=n.FriendAdd_Account;break;case U.FRIEND_DELETE:i["Accounts"]=n.FriendDel_Account;break;case U.PENDENCY_ADD:i["PendencyList"]=n.PendencyAdd;break;case U.PENDENCY_DELETE:i["Accounts"]=n.FrienPencydDel_Account;break;case U.BLACK_LIST_ADD:i["Accounts"]=n.BlackListAdd_Account;break;case U.BLACK_LIST_DELETE:i["Accounts"]=n.BlackListDel_Account;break;default:me.error("未知好友系统通知类型：friendNotice="+JSON.stringify(n));break}t?r==U.PENDENCY_ADD&&o[r]&&o[r](i):o[r]&&o[r](i)}},W=function(e,t){var n,o,i;for(var s in e){switch(n=e[s],o=n.PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>u&&(u=n.NoticeSeq),i={Type:o},o){case L.PROFILE_MODIFY:i["Profile_Account"]=n.Profile_Account,i["ProfileList"]=n.ProfileList;break;default:me.error("未知资料系统通知类型：profileNotice="+JSON.stringify(n));break}t?o==L.PROFILE_MODIFY&&r[o]&&r[o](i):r[o]&&r[o](i)}},Z=function(e){var t=e.MsgBody,o=t.ReportType,r=(e.GroupInfo.To_Account,{SrcFlag:1,ReportType:o,GroupId:e.ToGroupId,GroupName:e.GroupInfo.GroupName,Operator_Account:t.Operator_Account,MsgTime:e.MsgTimeStamp});switch(o){case b.JOIN_GROUP_REQUEST:r["RemarkInfo"]=t.RemarkInfo,r["MsgKey"]=t.MsgKey,r["Authentication"]=t.Authentication,r["UserDefinedField"]=e.UserDefinedField,r["From_Account"]=e.From_Account,r["MsgSeq"]=e.ClientSeq,r["MsgRandom"]=e.MsgRandom;break;case b.JOIN_GROUP_ACCEPT:case b.JOIN_GROUP_REFUSE:r["RemarkInfo"]=t.RemarkInfo;break;case b.KICK:case b.DESTORY:case b.CREATE:case b.INVITED_JOIN_GROUP_REQUEST:case b.INVITED_JOIN_GROUP_REQUEST_AGREE:case b.QUIT:case b.SET_ADMIN:case b.CANCEL_ADMIN:case b.REVOKE:break;case b.CUSTOM:r["MsgSeq"]=e.MsgSeq,r["UserDefinedField"]=t.UserDefinedField;break;default:me.error("未知群系统消息类型：reportType="+o);break}n[o]&&n[o](r)},oe=function(e){for(var t=0,n=e.length;t<n;t++)re(e[t])},re=function(e){var t=e.SubMsgType;switch(t){case P.READED:if(me.warn("C2C已读消息通知"),e.ReadC2cMsgNotify&&e.ReadC2cMsgNotify.UinPairReadArray&&_[t])for(var n=0,o=e.ReadC2cMsgNotify.UinPairReadArray.length;n<o;n++){var r=e.ReadC2cMsgNotify.UinPairReadArray[n];_[t](r)}break;case P.KICKEDOUT:me.warn("多终端互踢通知"),Le("instance"),_[t]&&_[t]();break;default:me.error("未知C2c系统消息：subType="+t);break}};this.longPolling=function(e,t){var n={Timeout:H/1e3,Cookie:{NotifySeq:a,NoticeSeq:u}};function o(){De(n,function(e){for(var t in e.EventArray){var n=e.EventArray[t];switch(n.Event){case G.C2C:a=n.NotifySeq,me.warn("longpolling: received new c2c msg"),qt.syncMsgs();break;case G.GROUP_COMMON:me.warn("longpolling: received new group msgs"),k(n.Event,n.GroupMsgArray);break;case G.GROUP_TIP:me.warn("longpolling: received new group tips"),k(n.Event,n.GroupTips);break;case G.GROUP_TIP2:me.warn("longpolling: received new group tips"),k(n.Event,n.GroupTips);break;case G.GROUP_SYSTEM:me.warn("longpolling: received new group system msgs"),w(n.GroupTips,!1);break;case G.FRIEND_NOTICE:me.warn("longpolling: received new friend system notice"),q(n.FriendListMod,!1);break;case G.PROFILE_NOTICE:me.warn("longpolling: received new profile system notice"),W(n.ProfileDataMod,!1);break;case G.C2C_COMMON:u=n.C2cMsgArray[0].NoticeSeq,me.warn("longpolling: received new c2c_common msg",u),A(n.Event,n.C2cMsgArray);break;case G.C2C_EVENT:u=n.C2cNotifyMsgArray[0].NoticeSeq,me.warn("longpolling: received new c2c_event msg"),oe(n.C2cNotifyMsgArray);break;default:me.error("longpolling收到未知新消息类型: Event="+n.Event);break}}var o={ActionStatus:I.OK,ErrorCode:0};ie(o)},function(e){ie(e),t&&t(e)})}j?(n.Cookie.LongPollingId=j,o()):bt({},function(e){j=n.Cookie.LongPollingId=e.LongPollingId,H=e.Timeout>60?H:1e3*e.Timeout,o()})},this.bigGroupLongPolling=function(e,t,n){var o={USP:1,StartSeq:f[e],HoldTime:p,Key:d[e]};we(o,function(n){var o=[];if(f[e]=n.NextSeq,p=n.HoldTime,d[e]=n.Key,n.RspMsgList&&n.RspMsgList.length>0){for(var r,i,s,a=0,u=n.RspMsgList.length-1;u>=0;u--){r=n.RspMsgList[u];var g={F_Account:"From_Account",T_Account:"To_Account",FAType:"EnumFrom_AccountType",TAType:"EnumTo_AccountType",GCode:"GroupCode",GName:"GroupName",GId:"GroupId",MFlg:"MsgFlag",FAEInfo:"MsgFrom_AccountExtraInfo",Evt:"Event",GInfo:"GroupInfo",BPlc:"IsPlaceMsg",MBody:"MsgBody",Pri:"MsgPriority",Rdm:"MsgRandom",MSeq:"MsgSeq",TStp:"MsgTimeStamp",TGId:"ToGroupId",UEInfo:"UinExtInfo",UId:"UserId",BSys:"IsSystemMsg",FAHUrl:"From_AccountHeadurl",FANick:"From_AccountNick"};if(r=de.replaceObject(g,r),!r.IsPlaceMsg&&r.From_Account&&r.MsgBody&&0!=r.MsgBody.length)switch(i=r.Event,i){case G.GROUP_COMMON:me.info("bigGroupLongPolling: return new group msg"),s=ue(r,!1,!1),s&&o.push(s),a+=1;break;case G.GROUP_TIP:case G.GROUP_TIP2:me.info("bigGroupLongPolling: return new group tip"),s=ue(r,!1,!1),s&&o.push(s);break;case G.GROUP_SYSTEM:me.info("bigGroupLongPolling: new group system msg"),Z(r);break;default:me.error("bigGroupLongPolling收到未知新消息类型: Event="+i);break}}a>0&&(qt.setBigGroupLongPollingMsgMap(r.ToGroupId,a),me.warn("current bigGroupLongPollingMsgMap: "+JSON.stringify(m)))}$=0;var _={ActionStatus:I.OK,ErrorCode:D.ON,ErrorInfo:"connection is ok..."};Lt.callBack(_),t?t(o):c&&c(o),l&&qt.bigGroupLongPolling(e)},function(t){if(t.ErrorCode==X?f[e]=0:t.ErrorCode!=V&&(me.error(t.ErrorInfo),$++),t.ErrorCode==z&&(me.error("多实例登录，被kick"),i&&i()),$<Q)l&&qt.bigGroupLongPolling(e);else{var o={ActionStatus:I.FAIL,ErrorCode:D.OFF,ErrorInfo:"connection is off"};Lt.callBack(o)}n&&n(t)},1e3*p)};var ie=function(e){if(0==e.ErrorCode||e.ErrorCode==V){var t;K=0,Y=!1;var n=!1;switch(B){case D.INIT:n=!0,B=D.ON,t="create connection successfully(INIT->ON)";break;case D.ON:t="connection is on...(ON->ON)";break;case D.RECONNECT:B=D.ON,t="connection is on...(RECONNECT->ON)";break;case D.OFF:n=!0,B=D.RECONNECT,t="reconnect successfully(OFF->RECONNECT)";break}var o={ActionStatus:I.OK,ErrorCode:B,ErrorInfo:t};n&&Lt.callBack(o),s&&qt.longPolling()}else if(e.ErrorCode==z)me.error("多实例登录，被kick"),i&&i();else if(K++,me.warn("longPolling接口第"+K+"次报错: "+e.ErrorInfo),K<=Q)setTimeout(se,100);else{B=D.OFF;var r={ActionStatus:I.FAIL,ErrorCode:D.OFF,ErrorInfo:"connection is off"};0==Y&&Lt.callBack(r),Y=!0,me.warn(J+"毫秒之后,SDK会发起新的longPolling请求..."),setTimeout(se,J)}},se=(A=function(t,n){var o=[],r=[];for(var i in r=n,r){var s,a,u=r[i],c=u.From_AccountHeadurl||"";u.From_Account==ne.identifier?(s=!0,a=u.To_Account):(s=!1,a=u.From_Account);var l=xt.sessByTypeId(g.C2C,a);l||(l=new kt(g.C2C,a,a,c,0,0));var f=new wt(l,s,u.MsgSeq,u.MsgRandom,u.MsgTimeStamp,u.From_Account,O.COMMON,u.From_AccountNick,c),p=null,d=null,m=null;for(var I in u.MsgBody){switch(p=u.MsgBody[I],m=p.MsgType,m){case M.TEXT:d=new wt.Elem.Text(p.MsgContent.Text);break;case M.FACE:d=new wt.Elem.Face(p.MsgContent.Index,p.MsgContent.Data);break;case M.IMAGE:for(var _ in d=new wt.Elem.Images(p.MsgContent.UUID,p.MsgContent.ImageFormat||""),p.MsgContent.ImageInfoArray){var E=p.MsgContent.ImageInfoArray[_];d.addImage(new wt.Elem.Images.Image(E.Type,E.Size,E.Width,E.Height,E.URL))}break;case M.SOUND:p.MsgContent?d=new wt.Elem.Sound(p.MsgContent.UUID,p.MsgContent.Second,p.MsgContent.Size,u.From_Account,u.To_Account,p.MsgContent.Download_Flag,g.C2C):(m=M.TEXT,d=new wt.Elem.Text("[语音消息]下载地址解析出错"));break;case M.LOCATION:d=new wt.Elem.Location(p.MsgContent.Longitude,p.MsgContent.Latitude,p.MsgContent.Desc);break;case M.FILE:case M.FILE+" ":m=M.FILE,p.MsgContent?d=new wt.Elem.File(p.MsgContent.UUID,p.MsgContent.FileName,p.MsgContent.FileSize,u.From_Account,u.To_Account,p.MsgContent.Download_Flag,g.C2C):(m=M.TEXT,d=new wt.Elem.Text("[文件消息下载地址解析出错]"));break;case M.CUSTOM:try{var T=JSON.parse(p.MsgContent.Data);if(T&&T.userAction&&T.userAction==x.ING)continue}catch(h){}m=M.CUSTOM,d=new wt.Elem.Custom(p.MsgContent.Data,p.MsgContent.Desc,p.MsgContent.Ext);break;default:m=M.TEXT,d=new wt.Elem.Text("web端暂不支持"+p.MsgType+"消息");break}f.elems.push(new wt.Elem(m,d))}f.elems.length>0&&xt.addMsg(f,!0)&&o.push(f)}o.length>0&&xt.updateTimeline(),o.length>0&&e&&e(o)},function(){s&&qt.longPolling()}),ae=function(e){for(var t in e){var n=e[t];switch(w(n.GroupTips,!0),n.Event){case G.GROUP_SYSTEM:me.warn("handlerApplyJoinGroupSystemMsgs： handler new group system msg"),w(n.GroupTips,!0);break;default:me.error("syncMsgs收到未知的群系统消息类型: Event="+n.Event);break}}};this.syncMsgs=function(t,n){var o=[],r=[];xe(xt.cookie,xt.syncFlag,function(n){for(var i in 2==n.SyncFlag&&(xt.syncFlag=0),r=n.MsgList,xt.cookie=n.Cookie,r){var s,a,u,c=r[i];c.From_Account==ne.identifier?(s=!0,a=c.To_Account,u=""):(s=!1,a=c.From_Account,u="");var l=xt.sessByTypeId(g.C2C,a);l||(l=new kt(g.C2C,a,a,u,0,0));var f=new wt(l,s,c.MsgSeq,c.MsgRandom,c.MsgTimeStamp,c.From_Account,O.COMMON,c.From_AccountNick,c.From_AccountHeadurl),p=null,d=null,m=null;for(var I in c.MsgBody){switch(p=c.MsgBody[I],m=p.MsgType,m){case M.TEXT:d=new wt.Elem.Text(p.MsgContent.Text);break;case M.FACE:d=new wt.Elem.Face(p.MsgContent.Index,p.MsgContent.Data);break;case M.IMAGE:for(var _ in d=new wt.Elem.Images(p.MsgContent.UUID,p.MsgContent.ImageFormat),p.MsgContent.ImageInfoArray){var E=p.MsgContent.ImageInfoArray[_];d.addImage(new wt.Elem.Images.Image(E.Type,E.Size,E.Width,E.Height,E.URL))}break;case M.SOUND:p.MsgContent?d=new wt.Elem.Sound(p.MsgContent.UUID,p.MsgContent.Second,p.MsgContent.Size,c.From_Account,c.To_Account,p.MsgContent.Download_Flag,g.C2C):(m=M.TEXT,d=new wt.Elem.Text("[语音消息]下载地址解析出错"));break;case M.LOCATION:d=new wt.Elem.Location(p.MsgContent.Longitude,p.MsgContent.Latitude,p.MsgContent.Desc);break;case M.FILE:case M.FILE+" ":m=M.FILE,p.MsgContent?d=new wt.Elem.File(p.MsgContent.UUID,p.MsgContent.FileName,p.MsgContent.FileSize,c.From_Account,c.To_Account,p.MsgContent.Download_Flag,g.C2C):(m=M.TEXT,d=new wt.Elem.Text("[文件消息下载地址解析出错]"));break;case M.CUSTOM:try{var T=JSON.parse(p.MsgContent.Data);if(T&&T.userAction&&T.userAction==x.ING)continue}catch(h){}m=M.CUSTOM,d=new wt.Elem.Custom(p.MsgContent.Data,p.MsgContent.Desc,p.MsgContent.Ext);break;default:m=M.TEXT,d=new wt.Elem.Text("web端暂不支持"+p.MsgType+"消息");break}f.elems.push(new wt.Elem(m,d))}f.elems.length>0&&xt.addMsg(f,!0)&&o.push(f)}ae(n.EventArray),o.length>0&&xt.updateTimeline(),t?t(o):o.length>0&&e&&e(o)},function(e){me.error("getMsgs failed:"+e.ErrorInfo),n&&n(e)})},this.getC2CHistoryMsgs=function(e,t,n){if(e.Peer_Account||!n)if(e.MaxCnt||(e.MaxCnt=15),e.MaxCnt<=0&&n)n(de.getReturnError("MaxCnt should be greater than 0",-14));else{if(e.MaxCnt>15)return n?void n(de.getReturnError("MaxCnt can not be greater than 15",-15)):void 0;null!=e.MsgKey&&void 0!==e.MsgKey||(e.MsgKey="");var o={Peer_Account:e.Peer_Account,MaxCnt:e.MaxCnt,LastMsgTime:e.LastMsgTime,MsgKey:e.MsgKey};Ye(o,function(n){var o=[],r=[];r=n.MsgList;var i=xt.sessByTypeId(g.C2C,e.Peer_Account);for(var s in i||(i=new kt(g.C2C,e.Peer_Account,e.Peer_Account,"",0,0)),r){var a,u=r[s],c=u.From_AccountHeadurl||"";u.From_Account==ne.identifier?(a=!0,u.To_Account):(a=!1,u.From_Account);var l=new wt(i,a,u.MsgSeq,u.MsgRandom,u.MsgTimeStamp,u.From_Account,O.COMMON,u.From_AccountNick,c),f=null,p=null,d=null;for(var m in u.MsgBody){switch(f=u.MsgBody[m],d=f.MsgType,d){case M.TEXT:p=new wt.Elem.Text(f.MsgContent.Text);break;case M.FACE:p=new wt.Elem.Face(f.MsgContent.Index,f.MsgContent.Data);break;case M.IMAGE:for(var I in p=new wt.Elem.Images(f.MsgContent.UUID,f.MsgContent.ImageFormat),f.MsgContent.ImageInfoArray){var _=f.MsgContent.ImageInfoArray[I];p.addImage(new wt.Elem.Images.Image(_.Type,_.Size,_.Width,_.Height,_.URL))}break;case M.SOUND:f.MsgContent?p=new wt.Elem.Sound(f.MsgContent.UUID,f.MsgContent.Second,f.MsgContent.Size,u.From_Account,u.To_Account,f.MsgContent.Download_Flag,g.C2C):(d=M.TEXT,p=new wt.Elem.Text("[语音消息]下载地址解析出错"));break;case M.LOCATION:p=new wt.Elem.Location(f.MsgContent.Longitude,f.MsgContent.Latitude,f.MsgContent.Desc);break;case M.FILE:case M.FILE+" ":d=M.FILE,f.MsgContent?p=new wt.Elem.File(f.MsgContent.UUID,f.MsgContent.FileName,f.MsgContent.FileSize,u.From_Account,u.To_Account,f.MsgContent.Download_Flag,g.C2C):(d=M.TEXT,p=new wt.Elem.Text("[文件消息下载地址解析出错]"));break;case M.CUSTOM:d=M.CUSTOM,p=new wt.Elem.Custom(f.MsgContent.Data,f.MsgContent.Desc,f.MsgContent.Ext);break;default:d=M.TEXT,p=new wt.Elem.Text("web端暂不支持"+f.MsgType+"消息");break}l.elems.push(new wt.Elem(d,p))}xt.addMsg(l),o.push(l)}if(xt.updateTimeline(),t){var E={Complete:n.Complete,MsgCount:o.length,LastMsgTime:n.LastMsgTime,MsgKey:n.MsgKey,MsgList:o};i.isFinished(n.Complete),t(E)}},function(e){me.error("getC2CHistoryMsgs failed:"+e.ErrorInfo),n&&n(e)})}else n(de.getReturnError("Peer_Account is empty",-13))},this.syncGroupMsgs=function(t,n,o){if(t.ReqMsgSeq<=0){if(o){var r="ReqMsgSeq must be greater than 0",i=de.getReturnError(r,-16);o(i)}}else{var s={GroupId:t.GroupId,ReqMsgSeq:t.ReqMsgSeq,ReqMsgNumber:t.ReqMsgNumber};gt(s,function(t){var o=[],r=(t.GroupId,t.RspMsgList),i=t.IsFinished;if(null!=r&&void 0!==r){for(var s=r.length-1;s>=0;s--){var a=r[s];if(!a.IsPlaceMsg&&a.From_Account&&a.MsgBody&&0!=a.MsgBody.length){var u=ue(a,!0,!0,i);u&&o.push(u)}}o.length>0&&xt.updateTimeline(),n?n(o):o.length>0&&e&&e(o)}else n&&n([])},function(e){me.error("getGroupMsgs failed:"+e.ErrorInfo),o&&o(e)})}};var ue=function(e,n,o,r){if(e.IsPlaceMsg||!e.From_Account||!e.MsgBody||0==e.MsgBody.length)return null;var i,s,a,u,c=e.ToGroupId,l=c;e.GroupInfo&&e.GroupInfo.GroupName&&(l=e.GroupInfo.GroupName),a=e.From_Account,e.GroupInfo&&(e.GroupInfo.From_AccountNick&&(a=e.GroupInfo.From_AccountNick),u=e.GroupInfo.From_AccountHeadurl?e.GroupInfo.From_AccountHeadurl:null),e.From_Account==ne.identifier?(i=!0,e.From_Account,s=""):(i=!1,e.From_Account,s="");var f=xt.sessByTypeId(g.GROUP,c);f||(f=new kt(g.GROUP,c,l,s,0,0)),"undefined"!==typeof r&&f.isFinished(r||0);var p=N.COMMON;if(G.GROUP_TIP==e.Event||G.GROUP_TIP2==e.Event){p=N.TIP;var d=e.MsgBody;e.MsgBody=[],e.MsgBody.push({MsgType:M.GROUP_TIP,MsgContent:d})}else e.MsgPriority&&(e.MsgPriority==v.REDPACKET?p=N.REDPACKET:e.MsgPriority==v.LOVEMSG&&(p=N.LOVEMSG));var m=new wt(f,i,e.MsgSeq,e.MsgRandom,e.MsgTimeStamp,e.From_Account,p,a,u),I=null,_=null,E=null;for(var T in e.MsgBody){switch(I=e.MsgBody[T],E=I.MsgType,E){case M.TEXT:_=new wt.Elem.Text(I.MsgContent.Text);break;case M.FACE:_=new wt.Elem.Face(I.MsgContent.Index,I.MsgContent.Data);break;case M.IMAGE:for(var h in _=new wt.Elem.Images(I.MsgContent.UUID,I.MsgContent.ImageFormat||""),I.MsgContent.ImageInfoArray)_.addImage(new wt.Elem.Images.Image(I.MsgContent.ImageInfoArray[h].Type,I.MsgContent.ImageInfoArray[h].Size,I.MsgContent.ImageInfoArray[h].Width,I.MsgContent.ImageInfoArray[h].Height,I.MsgContent.ImageInfoArray[h].URL));break;case M.SOUND:I.MsgContent?_=new wt.Elem.Sound(I.MsgContent.UUID,I.MsgContent.Second,I.MsgContent.Size,e.From_Account,e.To_Account,I.MsgContent.Download_Flag,g.GROUP):(E=M.TEXT,_=new wt.Elem.Text("[语音消息]下载地址解析出错"));break;case M.LOCATION:_=new wt.Elem.Location(I.MsgContent.Longitude,I.MsgContent.Latitude,I.MsgContent.Desc);break;case M.FILE:case M.FILE+" ":E=M.FILE;Ge(I.MsgContent.UUID,e.From_Account,I.MsgContent.FileName);I.MsgContent?_=new wt.Elem.File(I.MsgContent.UUID,I.MsgContent.FileName,I.MsgContent.FileSize,e.From_Account,e.To_Account,I.MsgContent.Download_Flag,g.GROUP):(E=M.TEXT,_=new wt.Elem.Text("[文件消息]地址解析出错"));break;case M.GROUP_TIP:var y=I.MsgContent.OpType;if(_=new wt.Elem.GroupTip(y,I.MsgContent.Operator_Account,c,e.GroupInfo.GroupName,I.MsgContent.List_Account,I.MsgContent.MsgMemberExtraInfo),F.JOIN==y||F.QUIT==y)_.setGroupMemberNum(I.MsgContent.MemberNum);else if(F.MODIFY_GROUP_INFO==y){var S=!1,C={GroupId:c,GroupFaceUrl:null,GroupName:null,OwnerAccount:null,GroupNotification:null,GroupIntroduction:null},A=I.MsgContent.MsgGroupNewInfo;if(A.GroupFaceUrl){var O=new wt.Elem.GroupTip.GroupInfo(R.FACE_URL,A.GroupFaceUrl);_.addGroupInfo(O),S=!0,C.GroupFaceUrl=A.GroupFaceUrl}if(A.GroupName){var P=new wt.Elem.GroupTip.GroupInfo(R.NAME,A.GroupName);_.addGroupInfo(P),S=!0,C.GroupName=A.GroupName}if(A.Owner_Account){var b=new wt.Elem.GroupTip.GroupInfo(R.OWNER,A.Owner_Account);_.addGroupInfo(b),S=!0,C.OwnerAccount=A.Owner_Account}if(A.GroupNotification){var U=new wt.Elem.GroupTip.GroupInfo(R.NOTIFICATION,A.GroupNotification);_.addGroupInfo(U),S=!0,C.GroupNotification=A.GroupNotification}if(A.GroupIntroduction){var L=new wt.Elem.GroupTip.GroupInfo(R.INTRODUCTION,A.GroupIntroduction);_.addGroupInfo(L),S=!0,C.GroupIntroduction=A.GroupIntroduction}0==n&&S&&t&&t(C)}else if(F.MODIFY_MEMBER_INFO==y){var k=I.MsgContent.MsgMemberInfo;for(var D in k){var w=k[D];_.addMemberInfo(new wt.Elem.GroupTip.MemberInfo(w.User_Account,w.ShutupTime))}}break;case M.CUSTOM:E=M.CUSTOM,_=new wt.Elem.Custom(I.MsgContent.Data,I.MsgContent.Desc,I.MsgContent.Ext);break;default:E=M.TEXT,_=new wt.Elem.Text("web端暂不支持"+I.MsgType+"消息");break}m.elems.push(new wt.Elem(E,_))}return 0==o?m:xt.addMsg(m,!0)?(m.extraInfo=e.GroupInfo.MsgFrom_AccountExtraInfo,m):null};this.init=function(a,u,l){if(a.onMsgNotify||me.warn("listeners.onMsgNotify is empty"),e=a.onMsgNotify,a.onBigGroupMsgNotify?c=a.onBigGroupMsgNotify:me.warn("listeners.onBigGroupMsgNotify is empty"),a.onC2cEventNotifys?_=a.onC2cEventNotifys:me.warn("listeners.onC2cEventNotifys is empty"),a.onGroupSystemNotifys?n=a.onGroupSystemNotifys:me.warn("listeners.onGroupSystemNotifys is empty"),a.onGroupInfoChangeNotify?t=a.onGroupInfoChangeNotify:me.warn("listeners.onGroupInfoChangeNotify is empty"),a.onFriendSystemNotifys?o=a.onFriendSystemNotifys:me.warn("listeners.onFriendSystemNotifys is empty"),a.onProfileSystemNotifys?r=a.onProfileSystemNotifys:me.warn("listeners.onProfileSystemNotifys is empty"),a.onKickedEventCall?i=a.onKickedEventCall:me.warn("listeners.onKickedEventCall is empty"),a.onLongPullingNotify?onLongPullingNotify=a.onLongPullingNotify:me.warn("listeners.onKickedEventCall is empty"),a.onAppliedDownloadUrl?a.onAppliedDownloadUrl:me.warn("listeners.onAppliedDownloadUrl is empty"),ne.identifier&&ne.userSig)y(function(e){me.info("initMyGroupMaxSeqs success"),h(function(e){if(me.info("initIpAndAuthkey success"),u){me.info("login success(have login state))");var t={ActionStatus:I.OK,ErrorCode:0,ErrorInfo:"login success"};u(t)}qt.setLongPollingOn(!0),s&&qt.longPolling(u)},l)},l);else if(u){var f={ActionStatus:I.OK,ErrorCode:0,ErrorInfo:"login success(no login state)"};u(f)}},this.sendMsg=function(e,t,n){ke(e,function(o){if(e.sess.type()==g.C2C){if(!xt.addMsg(e)){var r="sendMsg: addMsg failed!",i=de.getReturnError(r,-17);return me.error(r),void(n&&n(i))}xt.updateTimeline()}t&&t(o)},function(e){n&&n(e)})}},Bt=new function(){this.fileMd5=null;var e=function(e,t,n){var o=null;try{o=new FileReader}catch(f){if(n)return void n(de.getReturnError("当前浏览器不支持FileReader",-18))}var r=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(r||!n){var s=209715200,a=Math.ceil(e.size/s),u=0,c=new i;o.onload=function(e){for(var n="",o=new Uint8Array(e.target.result),r=o.byteLength,i=0;i<r;i++)n+=String.fromCharCode(o[i]);c.appendBinary(n),u++,u<a?l():(this.fileMd5=c.end(),t&&t(this.fileMd5))},l()}else n(de.getReturnError("当前浏览器不支持FileAPI",-19));function l(){var t=u*s,n=t+s>=e.size?e.size:t+s,i=r.call(e,t,n);o.readAsArrayBuffer(i)}};this.uploadFile=function(t,n,o){var r={init:function(e,t,n){var o=this;o.file=e.file,o.onProgressCallBack=e.onProgressCallBack,e.abortButton&&(e.abortButton.onclick=o.abortHandler),o.total=o.file.size,o.loaded=0,o.step=1105920,o.sliceSize=0,o.sliceOffset=0,o.timestamp=Ie(),o.seq=_e(),o.random=Me(),o.fromAccount=ne.identifier,o.toAccount=e.To_Account,o.fileMd5=e.fileMd5,o.businessType=e.businessType,o.fileType=e.fileType,o.cbOk=t,o.cbErr=n,o.reader=new FileReader,o.blobSlice=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,o.reader.onloadstart=o.onLoadStart,o.reader.onprogress=o.onProgress,o.reader.onabort=o.onAbort,o.reader.onerror=o.onerror,o.reader.onload=o.onLoad,o.reader.onloadend=o.onLoadEnd},upload:function(){var e=r;e.readBlob(0)},onLoadStart:function(){},onProgress:function(e){var t=r;t.loaded+=e.loaded,t.onProgressCallBack&&t.onProgressCallBack(t.loaded,t.total)},onAbort:function(){},onError:function(){},onLoad:function(e){var t=r;if(e.target.readyState==FileReader.DONE){var n=e.target.result,o=n.indexOf(",");-1!=o&&(n=n.substr(o+1));var i={From_Account:t.fromAccount,To_Account:t.toAccount,Busi_Id:t.businessType,File_Type:t.fileType,File_Str_Md5:t.fileMd5,PkgFlag:h.BASE64_DATA,File_Size:t.total,Slice_Offset:t.sliceOffset,Slice_Size:t.sliceSize,Slice_Data:n,Seq:t.seq,Timestamp:t.timestamp,Random:t.random},s=function(e){if(0==e.IsFinish)t.loaded=e.Next_Offset,t.loaded<t.total?t.readBlob(t.loaded):t.loaded=t.total;else if(t.cbOk){var n={ActionStatus:e.ActionStatus,ErrorCode:e.ErrorCode,ErrorInfo:e.ErrorInfo,File_UUID:e.File_UUID,File_Size:e.Next_Offset,URL_INFO:e.URL_INFO,Download_Flag:e.Download_Flag};t.fileType==C.FILE&&(n.URL_INFO=Ge(e.File_UUID,ne.identifier,t.file.name)),t.cbOk(n)}W=0},a=function e(n){W<Z?(W++,setTimeout(function(){vt(i,s,e)},1e3)):t.cbErr(n)};vt(i,s,a)}},onLoadEnd:function(){},readBlob:function(e){var t,n=r,o=n.file,i=e+n.step;i>n.total?(i=n.total,n.sliceSize=i-e):n.sliceSize=n.step,n.sliceOffset=e,t=n.blobSlice.call(o,e,i),n.reader.readAsDataURL(t)},abortHandler:function(){var e=r;e.reader&&e.reader.abort()}};e(t.file,function(e){me.info("fileMd5: "+e),t.fileMd5=e,r.init(t,n,o),r.upload()},o)}};e.SESSION_TYPE=g,e.MSG_MAX_LENGTH=m,e.C2C_MSG_SUB_TYPE=O,e.GROUP_MSG_SUB_TYPE=N,e.MSG_ELEMENT_TYPE=M,e.GROUP_TIP_TYPE=F,e.IMAGE_TYPE=E,e.GROUP_SYSTEM_TYPE=b,e.FRIEND_NOTICE_TYPE=U,e.GROUP_TIP_MODIFY_GROUP_INFO_TYPE=R,e.BROWSER_INFO=c,e.Emotions=e.EmotionPicData=ge,e.EmotionDataIndexs=e.EmotionPicDataIndex=pe,e.TLS_ERROR_CODE=k,e.CONNECTION_STATUS=D,e.UPLOAD_PIC_BUSSINESS_TYPE=w,e.RECENT_CONTACT_TYPE=d,e.UPLOAD_RES_TYPE=C,e.Tool=de,e.Log=me,e.Msg=wt,e.Session=kt,e.MsgStore={sessMap:function(){return xt.sessMap()},sessCount:function(){return xt.sessCount()},sessByTypeId:function(e,t){return xt.sessByTypeId(e,t)},delSessByTypeId:function(e,t){return xt.delSessByTypeId(e,t)},resetCookieAndSyncFlag:function(){return xt.resetCookieAndSyncFlag()}},e.Resources=fe,e.login=e.init=function(e,t,n,o,r){Lt.init(t.onConnNotify,o,r),ve(e,t,n,o,r)},e.logout=e.offline=function(e,t){return Le("instance",e,t)},e.logoutAll=function(e,t){return Le("all",e,t)},e.sendMsg=function(e,t,n){return qt.sendMsg(e,t,n)},e.syncMsgs=function(e,t){return qt.syncMsgs(e,t)},e.getC2CHistoryMsgs=function(e,t,n){return qt.getC2CHistoryMsgs(e,t,n)},e.syncGroupMsgs=function(e,t,n){return qt.syncGroupMsgs(e,t,n)},e.c2CMsgReaded=function(e,t,n){return xt.c2CMsgReaded(e,t,n)},e.groupMsgReaded=function(e,t,n){return dt(e,t,n)},e.setAutoRead=function(e,t,n){return xt.setAutoRead(e,t,n)},e.createGroup=function(e,t,n){return Ke(e,t,n)},e.createGroupHigh=function(e,t,n){return He(e,t,n)},e.applyJoinGroup=function(e,t,n){return Ve(e,t,n)},e.handleApplyJoinGroupPendency=function(e,t,n){return Xe(e,t,n)},e.getPendencyGroup=function(e,t,n){return je(e,t,n)},e.getPendencyGroupRead=function(e,t,n){return $e(e,t,n)},e.handleInviteJoinGroupRequest=function(e,t,n){return Qe(e,t,n)},e.deleteApplyJoinGroupPendency=function(e,t,n){return Be(e,t,n)},e.quitGroup=function(e,t,n){return We(e,t,n)},e.searchGroupByName=function(e,t,n){return et(e,t,n)},e.getGroupPublicInfo=function(e,t,n){return tt(e,t,n)},e.getGroupInfo=function(e,t,n){return nt(e,t,n)},e.modifyGroupBaseInfo=function(e,t,n){return Je(e,t,n)},e.getGroupMemberInfo=function(e,t,n){return ot(e,t,n)},e.addGroupMember=function(e,t,n){return rt(e,t,n)},e.modifyGroupMember=function(e,t,n){return it(e,t,n)},e.deleteGroupMember=function(e,t,n){return st(e,t,n)},e.destroyGroup=function(e,t,n){return at(e,t,n)},e.changeGroupOwner=function(e,t,n){return ut(e,t,n)},e.getJoinedGroupListHigh=function(e,t,n){return ct(e,t,n)},e.getRoleInGroup=function(e,t,n){return lt(e,t,n)},e.forbidSendMsg=function(e,t,n){return ft(e,t,n)},e.sendCustomGroupNotify=function(e,t,n){return pt(e,t,n)},e.applyJoinBigGroup=function(e,t,n){return ze(e,t,n)},e.quitBigGroup=function(e,t,n){return Ze(e,t,n)},e.getProfilePortrait=function(e,t,n){return Ct(e,t,n)},e.setProfilePortrait=function(e,t,n){return At(e,t,n)},e.applyAddFriend=function(e,t,n){return It(e,t,n)},e.getPendency=function(e,t,n){return Et(e,t,n)},e.getPendencyReport=function(e,t,n){return Tt(e,t,n)},e.deletePendency=function(e,t,n){return ht(e,t,n)},e.responseFriend=function(e,t,n){return yt(e,t,n)},e.getAllFriend=function(e,t,n){return St(e,t,n)},e.deleteChat=function(e,t,n){return Mt(e,t,n)},e.deleteFriend=function(e,t,n){return _t(e,t,n)},e.addBlackList=function(e,t,n){return Gt(e,t,n)},e.deleteBlackList=function(e,t,n){return Ot(e,t,n)},e.getBlackList=function(e,t,n){return Pt(e,t,n)},e.getRecentContactList=function(e,t,n){return Nt(e,t,n)},e.uploadFile=e.uploadPic=function(e,t,n){return Bt.uploadFile(e,t,n)},e.submitUploadFileForm=function(e,t,n){return Bt.submitUploadFileForm(e,t,n)},e.uploadFileByBase64=e.uploadPicByBase64=function(e,t,n){var o={To_Account:e.toAccount,Busi_Id:e.businessType,File_Type:e.File_Type,File_Str_Md5:e.fileMd5,PkgFlag:h.BASE64_DATA,File_Size:e.totalSize,Slice_Offset:0,Slice_Size:e.totalSize,Slice_Data:e.base64Str,Seq:_e(),Timestamp:Ie(),Random:Me()};return vt(o,t,n)},e.getLongPollingId=function(e,t,n){return bt(e,t,n)},e.applyDownload=function(e,t,n){return Ut(e,t,n)},e.checkLogin=function(e,t){return ye(e,t)}})(c);var l,f={webim:c},p=n("c0d6"),g=f.webim,d=50,m=12,I={},M="",E="",T="",h=15,y=null,S=null,C={sdkAppID:"1400194712",identifier:p["a"].state.user.im,accountType:36862,userSig:p["a"].state.user.im_sig,identifierNick:p["a"].state.user.nickName||"",headurl:p["a"].state.user.avatar},A={},G={},O={},P={jsonpCallback:ue,onMsgNotify:D,onC2cEventNotifys:F},N={isAccessFormalEnv:!0,isLogOn:!1};function v(e,t){l=e,C.userSig=p["a"].state.user.im_sig,y=l.selToID,M=l.isTeam?g.SESSION_TYPE.GROUP:g.SESSION_TYPE.C2C,g.login(C,P,N,function(e){t&&t()},function(e){})}function F(e){var t=g.MsgStore.sessMap()[g.SESSION_TYPE.C2C+e.From_Account];if(t){var n=_.clone(t.msgs()),o=_.remove(n,function(t){return t.time<=e.LastReadTime}),r=t.unread()-o.length;r=r>0?r:0,t.unread(r)}}function R(e,t){e||(e=[l.selToID]);var n=["Tag_Profile_IM_Nick","Tag_Profile_IM_Gender","Tag_Profile_IM_Location","Tag_Profile_IM_Image","Tag_Profile_IM_Role"],o={To_Account:e,TagList:n};g.getProfilePortrait(o,function(e){if(e.UserProfileItem&&e.UserProfileItem.length>0){for(var n in e.UserProfileItem){var o,r,i;if(e.UserProfileItem[n].ProfileItem)for(var s in e.UserProfileItem[n].ProfileItem){switch(e.UserProfileItem[n].ProfileItem[s].Tag){case"Tag_Profile_IM_Nick":o=e.UserProfileItem[n].ProfileItem[s].Value;break;case"Tag_Profile_IM_Gender":r=e.UserProfileItem[n].ProfileItem[s].Value;break;case"Tag_Profile_IM_Location":e.UserProfileItem[n].ProfileItem[s].Value;break;case"Tag_Profile_IM_Image":i=e.UserProfileItem[n].ProfileItem[s].Value;break;case"Tag_Profile_IM_Role":e.UserProfileItem[n].ProfileItem[s].Value;break}var a=g.SESSION_TYPE.C2C+"_"+e.UserProfileItem[n].To_Account;O[a]={name:o,image:i,gender:r}}else{a=g.SESSION_TYPE.C2C+"_"+e.UserProfileItem[n].To_Account;O[a]={name:e.UserProfileItem[n].To_Account,image:E,gender:r}}}t&&t()}},function(e){})}function b(){R([y],function(){var e=g.SESSION_TYPE.C2C+"_"+y,t=O[e];t&&t.name?l.infoname_text=t.name:l.infoname_text=t.name||"11"})}function U(e){if(y){var t,n,o=e,r=g.Tool.getStrBytes(o);if(o.length<1)ae("发送的消息不能为空!");else M==g.SESSION_TYPE.C2C?(t=g.MSG_MAX_LENGTH.C2C,n="消息长度超出限制(最多"+Math.round(t/3)+"汉字)"):(t=g.MSG_MAX_LENGTH.GROUP,n="消息长度超出限制(最多"+Math.round(t/3)+"汉字)"),r>t?ae(n):(H(y,o),ce(100))}else ae("你还没有选中好友或者群组，暂不能聊天!")}var L=[],k=null;function D(e){var t,n,o,r=g.MsgStore.sessMap();for(var i in e){var s;if(n=e[i],y)n.getSession().id()==y&&(J(n,!0),ce(100));else y=n.getSession().id(),M=n.getSession().type(),S=n.getSession(),t=n.getSession(),o="TIMCustomElem"==t.msgs()[t.msgs().length-1].elems[0].type?"[图片]":"TIMFaceElem"==t.msgs()[t.msgs().length-1].elems[0].type?"[表情]":t.msgs()[t.msgs().length-1].elems[0].content.text,s=M==g.SESSION_TYPE.C2C?E:groupHeadUrl,se(M,y,n.getSession().name(),s,n.getSession().unread(),"sesslist","",n.getSession().time(),o);L.push(n.elems[0].content.text)}if(!y)for(var a in r)t=r[a],o="TIMCustomElem"==t.msgs()[t.msgs().length-1].elems[0].type?"[图片]":"TIMFaceElem"==t.msgs()[t.msgs().length-1].elems[0].type?"[表情]":t.msgs()[t.msgs().length-1].elems[0].content.text,y!=t.id()&&(k||(k=new Date),ie(t.type(),t.id(),t.name(),t.unread(),t.time(),o),new Date)}var w=function(e,t){if(M!=g.SESSION_TYPE.GROUP&&y&&"@TIM#SYSTEM"!=y){var n=0,o="",r={Peer_Account:y,MaxCnt:h,LastMsgTime:n,MsgKey:o};S=null,g.MsgStore.delSessByTypeId(M,y),g.getC2CHistoryMsgs(r,function(t){t.Complete;0!=t.MsgList.length&&(A[y]={LastMsgTime:t.LastMsgTime,MsgKey:t.MsgKey},e&&e(t.MsgList))},t)}},x=function(e,t){if(M==g.SESSION_TYPE.GROUP)return!1;var n,o,r=A[y];if(!r)return!1;n=r.LastMsgTime,o=r.MsgKey;var i={Peer_Account:y,MaxCnt:h,LastMsgTime:n,MsgKey:o};g.getC2CHistoryMsgs(i,function(t){t.Complete;if(0==t.MsgList.length)return l.isLoading=!1,!1;A[y]={LastMsgTime:t.LastMsgTime,MsgKey:t.MsgKey},e?e(t.MsgList):K(t.MsgList,!0)},function(e){l.isLoading=!1})},q=function(e){M!=g.SESSION_TYPE.C2C&&Y(y,function(t){var n={GroupId:y,ReqMsgSeq:t.GroupInfo[0].NextMsgSeq-1,ReqMsgNumber:h};null==n.ReqMsgSeq||void 0==n.ReqMsgSeq||n.ReqMsgSeq<=0?g.Log.warn("该群还没有历史消息:options="+JSON.stringify(n)):(S=null,g.MsgStore.delSessByTypeId(M,y),I[g.SESSION_TYPE.GROUP+"_"+y]={},I[g.SESSION_TYPE.GROUP+"_"+y].MsgGroupReadedSeq=t.GroupInfo&&t.GroupInfo[0]&&t.GroupInfo[0].MsgSeq,g.syncGroupMsgs(n,function(t){if(0!=t.length){var o=t[0].seq-1;G[y]={ReqMsgSeq:o},e&&e(t)}else g.Log.warn("该群没有历史消息了:options="+JSON.stringify(n))},function(e){l.$toast.fail("未加入群"),l.toBack()}))})},B=function(e){if(M!=g.SESSION_TYPE.C2C){var t,n=G[y];if(!n)return!1;if(t=n.ReqMsgSeq,t<=0)return!1;var o={GroupId:y,ReqMsgSeq:t,ReqMsgNumber:h};g.syncGroupMsgs(o,function(t){0==t.length&&(l.$toast("已加载完"),l.isLoading=!1);var n=t[0].seq-1;G[y]={ReqMsgSeq:n},e?e(t):K(t,!0)},function(e){l.isLoading=!1})}},Y=function(e,t,n){var o={GroupIdList:[e],GroupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","ShutUpAllMember"],MemberInfoFilter:["Account","Role","JoinTime","LastSendMsgTime","ShutUpUntil"]};g.getGroupInfo(o,function(e){"On"==e.GroupInfo[0].ShutUpAllMember&&l.$toast.fail("该群组已开启全局禁言"),t&&t(e)},function(e){l.$toast.fail("未加入群"),l.toBack()})};function K(e,t){var n;for(var o in t=t||!1,t||e.reverse(),e)n=e[o],n.getSession().id()==y&&(S=n.getSession(),J(n,t));g.setAutoRead(S,!0,!0)}function H(e,t){if(!n)var n=new g.Session(M,e,e,E,Math.round((new Date).getTime()/1e3));var o,r=!0,i=-1,s=Math.round(4294967296*Math.random()),a=Math.round((new Date).getTime()/1e3);o=M==g.SESSION_TYPE.C2C?g.C2C_MSG_SUB_TYPE.COMMON:g.GROUP_MSG_SUB_TYPE.COMMON;var u,c,f,p,d,m,I=new g.Msg(n,r,i,s,a,C.identifier,o,C.identifierNick),_=/\[[^[\]]{1,3}\]/gm,T=t.match(_);if(!T||T.length<1)u=new g.Msg.Elem.Text(t),I.addText(u);else{for(var h=0;h<T.length;h++)f=t.substring(0,t.indexOf(T[h])),f&&(u=new g.Msg.Elem.Text(f),I.addText(u)),p=g.EmotionDataIndexs[T[h]],d=g.Emotions[p],d?(c=new g.Msg.Elem.Face(p,T[h]),I.addFace(c)):(u=new g.Msg.Elem.Text(T[h]),I.addText(u)),m=t.indexOf(T[h])+T[h].length,t=t.substring(m);t&&(u=new g.Msg.Elem.Text(t),I.addText(u))}I.PushInfoBoolean=!0,I.sending=1,I.originContent=t,M==g.SESSION_TYPE.C2C&&J(I,!0),l.msgedit="",g.sendMsg(I,function(e){},function(e){10017==e.ErrorCode&&l.$toast.fail("该群组已开启全局禁言")})}function J(e,t){var n,o,r,i,s,a;if(e.getSession().type(),n=e.getIsSend(),o=e.getFromAccount(),o){if(n)C.identifierNick?C.identifierNick:o,r=C.headurl?l.$fnc.getImgUrl(C.headurl):E,s="jstx_conta_r";else{var u=g.SESSION_TYPE.C2C+"_"+o,c=O[u];c&&c.name?c.name:e.getFromAccountNick()?e.getFromAccountNick():o,r=c&&c.image?l.$fnc.getImgUrl(c.image):e.fromAccountHeadurl?e.fromAccountHeadurl:E,s="jstx_conta_l"}switch(a=g.Tool.formatTimeStamp(e.getTime()),""==T?T=a:(new Date(a).getTime()-new Date(T).getTime())/1e3>60?T=a:(T=a,a=""),i=e.getSubType(),i){case g.GROUP_MSG_SUB_TYPE.COMMON:e=V(e);break;case g.GROUP_MSG_SUB_TYPE.REDPACKET:e="[群红包消息]"+V(e);break;case g.GROUP_MSG_SUB_TYPE.LOVEMSG:e="[群点赞消息]"+V(e);break;case g.GROUP_MSG_SUB_TYPE.TIP:e=V(e);break}t?l.textvalue.push({msg:e,avter:r,time:a,classname:s}):l.textvalue.unshift({msg:e,avter:r,time:a,classname:s})}}function V(e){var t,n,o,r,i="",s=[],a=0;t=e.getElems();for(var u=t.length,c=0;c<u;c++)switch(n=t[c],o=n.getType(),r=n.getContent(),o){case g.MSG_ELEMENT_TYPE.TEXT:var l=X(r);i+=g.Tool.formatText2Html(l);break;case g.MSG_ELEMENT_TYPE.FACE:return i=j(r),a=1,{html:i,types:a};case g.MSG_ELEMENT_TYPE.IMAGE:break;case g.MSG_ELEMENT_TYPE.SOUND:i+=convertSoundMsgToHtml(r);break;case g.MSG_ELEMENT_TYPE.FILE:i+=convertFileMsgToHtml(r);break;case g.MSG_ELEMENT_TYPE.LOCATION:i+=convertLocationMsgToHtml(r);break;case g.MSG_ELEMENT_TYPE.CUSTOM:s=$(r);return s;case g.MSG_ELEMENT_TYPE.GROUP_TIP:l=z(r);return i+=g.Tool.formatText2Html(l),a=99,{html:i,types:a};default:g.Log.error("未知消息元素类型: elemType="+o);break}return{html:i,types:a}}function z(e){var t,n,o,r=10,i="",s=r-1;switch(t=e.getOpType(),n="群主",t){case g.GROUP_TIP_TYPE.JOIN:for(var a in o=e.getUserInfo(),o)if(i+=o[a].NickName?o[a].NickName:"有新成员,",o.length>r&&a==s){i+="等"+o.length+"人";break}i=i.substring(0,i.length-1),i+="加入该群，当前群成员数："+e.getGroupMemberNum();break;case g.GROUP_TIP_TYPE.QUIT:i+=n+"离开该群，当前群成员数："+e.getGroupMemberNum();break;case g.GROUP_TIP_TYPE.KICK:for(var a in i+=n+"将",o=e.getUserInfo(),o)if(i+=o[a].NickName?o[a].NickName:"成员,",o.length>r&&a==s){i+="等"+o.length+"人";break}i+="踢出该群";break;case g.GROUP_TIP_TYPE.SET_ADMIN:for(var a in i+=n+"将",o=e.getUserInfo(),o)if(i+=o[a].NickName+",",o.length>r&&a==s){i+="等"+o.length+"人";break}i+="设为管理员";break;case g.GROUP_TIP_TYPE.CANCEL_ADMIN:for(var a in i+=n+"取消",o=e.getUserInfo(),o)if(i+=o[a].NickName+",",o.length>r&&a==s){i+="等"+o.length+"人";break}i+="的管理员资格";break;case g.GROUP_TIP_TYPE.MODIFY_GROUP_INFO:i+=n+"修改了群资料";break;case g.GROUP_TIP_TYPE.MODIFY_MEMBER_INFO:i+=n+"修改了群成员资料:";var u,c,l=e.getMemberInfoList();for(var a in l)if(u=l[a].getUserId(),c=l[a].getShutupTime(),i+=u+": ",i+=null!=c&&void 0!==c?0==c?"取消禁言; ":"禁言"+c+"秒; ":" shutupTime为空",l.length>r&&a==s){i+="等"+l.length+"人";break}break;default:i+="未知群提示消息类型：type="+t;break}return i}function X(e){return e.getText()}function j(e){var t=null,n=e.getData(),o=g.EmotionDataIndexs[n],r=g.Emotions[o];return r&&r[1]&&(t=r[1]),t||n}function $(e){var t={};return t.oid=e.getDesc(),t.types=Number(e.getExt()),0==t.types||""==t.types||isNaN(t.types)?(t.types=1,t.html=l.$fnc.getImgUrl(e.getData()),t.html=g.Tool.formatText2Html(t.html)):(t.html=e.getData(),t.html=g.Tool.formatText2Html(t.html)),t}var Q=function(){if(l.emotionFlag)l.emotionFlag=!1;else{if(l.emotionFlag=!0,0==l.emoji.length)for(var e in g.Emotions)l.emoji.push({img:g.Emotions[e][1],text:g.Emotions[e][0]});ce()}},W=function(e){l.emotionFlag=!1,U(e)};function Z(e){M==g.SESSION_TYPE.C2C?g.UPLOAD_PIC_BUSSINESS_TYPE.C2C_MSG:M==g.SESSION_TYPE.GROUP&&g.UPLOAD_PIC_BUSSINESS_TYPE.GROUP_MSG,ee(e),ce()}function ee(e){if(y){S||(S=new g.Session(M,y,y,E,Math.round((new Date).getTime()/1e3)));var t=new g.Msg(S,!0,-1,-1,-1,C.identifier,0,C.identifierNick),n=new g.Msg.Elem.Custom(e,"","");t.addCustom(n),t.sending=1,g.sendMsg(t,function(e){M==g.SESSION_TYPE.C2C&&J(t,!0),ce()},function(e){})}}function te(){y=null,g.logout()}var ne=function(e,t){var n={Count:d};g.getRecentContactList(n,function(e,t){var n=[],o=[];if(e.SessionItem&&e.SessionItem.length>0){for(var r in e.SessionItem)1==e.SessionItem[r].Type?n.push(e.SessionItem[r].To_Account):o.push(e.SessionItem[r].ToAccount);R(n,function(){oe(e,t)})}},t)};function oe(e,t){var n,o;for(var r in I=[],e.SessionItem){var i,s,a=e.SessionItem[r],u=a.Type,c="",f="",p="",d="",_="";if(u==g.RECENT_CONTACT_TYPE.C2C){if("私聊",i=g.SESSION_TYPE.C2C,s=a.To_Account,"@TIM#SYSTEM"==s){g.Log.warn("过滤好友系统消息,sessionId="+s);continue}var M=i+"_"+s,T=O[M];c=T&&T.name?T.name:s,f=T&&T.image?T.image:E,_=T&&"1"==T.gender?"../../static/img/im/nan.png":T&&"2"==T.gender?"../../static/img/im/nv.png":"",p=d=""}else if(u==g.RECENT_CONTACT_TYPE.GROUP){if("群聊",i=g.SESSION_TYPE.GROUP,s=a.ToAccount,c=a.GroupNick,a.GroupImage)f=a.GroupImage;else{M=i+"_"+s;var h=O[M];f=h&&h.image?h.image:groupHeadUrl}if(p=a.MsgGroupFrom_Account,!p){g.Log.warn("群消息发送者id为空,senderId="+p+",groupid="+s);continue}if("@TIM#SYSTEM"==p){g.Log.warn("过滤群系统消息,senderId="+p+",groupid="+s);continue}if(d=a.MsgGroupFromCardName,!d&&(d=a.MsgGroupFromNickName,!d&&!c)){M=g.SESSION_TYPE.C2C+"_"+p,T=O[M];T&&T.name?d=T.name:c=p}}else"未知类型",s=a.ToAccount;s?"@TLS#NOT_FOUND"!=s?(c.length>m&&(c=c.substr(0,m)+"..."),n=I[i+"_"+s],n||(o||(i,o=s),I[i+"_"+s]={SessionType:i,SessionId:s,SessionNick:c,SessionImage:f,C2cAccount:p,C2cNick:d,UnreadMsgCount:a.UnreadMsgCount,MsgSeq:a.MsgSeq,MsgRandom:a.MsgRandom,MsgTimeStamp:g.Tool.formatTimeStamp(a.MsgTimeStamp),MsgGroupReadedSeq:a.MsgGroupReadedSeq||0,MsgShow:a.MsgShow,sessiongender:_})):g.Log.warn("会话id不存在,sessionId="+s):g.Log.warn("会话id为空,sessionId="+s)}if(!l.is_index)for(var r in I)l.userList=l.userList||[],l.userList.push({im:I[r].SessionId,avatar:I[r].SessionImage,nickname:I[r].SessionNick,MsgTimeStamp:I[r].MsgTimeStamp,MsgShow:I[r].MsgShow,sex:I[r].MsgShow.sessiongender,unread:0});g.syncMsgs(re),t&&t()}function re(){var e,t=g.MsgStore.sessMap(),n=new Array;for(var o in t)e=t[o],n[e.time()]=e;for(var o in n)e=n[o],ie(e.type(),e.id(),e.name(),e.unread(),e.time(),e.msgs()[e.msgs().length-1].elems[0].content.text)}function ie(e,t,n,o,r,i){if("yunpt_7"!=t)if(l.is_index){for(var s=!1,a=0;a<l.chatlist.length;a++)l.chatlist[a]["im"]==t&&(s=!0);if(!s){R([t]);var u=e+"_"+t,c=O[u];l.chatlist.unshift({im:t,avatar:c.image})}}else{for(a=0;a<l.userList.length;a++)l.userList[a]["im"]==t&&l.userList.splice(a,1);se(e,t,n,"",o,"sesslist","",r,i)}}function se(e,t,n,o,r,i,s,a,u){R([t],function(){for(var o=0;o<l.userList.length;o++)l.userList[o]["im"]==t&&l.userList.splice(o,1);var i=e+"_"+t,s=O[i];l.userList.unshift({im:t,avatar:s.image,nickname:s.name,username:n,MsgTimeStamp:g.Tool.formatTimeStamp(a),MsgShow:u,unread:r})})}function ae(e){}function ue(e){g.setJsonpLastRspData(e)}function ce(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";l.$nextTick(function(){var t=document.querySelector("#msg_box");l.$nextTick(function(){""==e&&(t.scrollTop=t.scrollHeight-t.clientHeight+5e6)})})}t["a"]={webimLogin:v,onSendMsg:U,getPrePageC2CHistoryMsgs:x,getLastGroupHistoryMsgs:q,getPrePageGroupHistoryMsgs:B,getHistoryMsgCallback:K,showEmotionDialog:Q,selectEmotionImg:W,onClose:te,uploadPic:Z,bdscrollbar:ce,initRecentContactList:ne,getLastC2CHistoryMsgs:w,setProfilePortraitClick:R,infoname:b,initUnreadMsgCount:re}},"91a8":function(e,t,n){e.exports=n.p+"img/07无语.bfaf02b8.gif"},"99b5":function(e,t,n){e.exports=n.p+"img/04OK.4c1f9a1b.gif"},c1ee:function(e,t,n){e.exports=n.p+"img/06大哭.7955583c.gif"},e56a:function(e,t,n){e.exports=n.p+"img/05么么哒.b92a2c88.gif"},ec34e:function(e,t,n){e.exports=n.p+"img/03委屈.0bb94f68.gif"}}]);